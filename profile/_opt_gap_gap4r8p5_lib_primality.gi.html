<!DOCTYPE html><script src="sorttable.js"></script><html><body>
<style>
table { border-collapse: collapse }
tr .linenum { text-align: right; }
tr:nth-child(odd)  { background-color: #EEE; }
tr:nth-child(even)  { background-color: #FFF; }
tr:nth-child(odd).exec  { background-color: #0F0; }
tr:nth-child(even).exec  { background-color: #3F3; }
tr:nth-child(odd).missed  { background-color: #F00; }
tr:nth-child(even).missed  { background-color: #F33; }
td, th {
    border: 1px solid #98bf21;
    padding: 3px 7px 2px 7px;
}
th {
    font-size: 1.1em;
    text-align: left;
    padding-top: 5px;
    padding-bottom: 4px;
    background-color: #A7C942;
    color: #ffffff;
}
table.sortable th:not(.sorttable_sorted):not(.sorttable_sorted_reverse):not(.sorttable_nosort):after {
    content: " \25B4\25BE"
}

/* HSV gradient made using http://www.perbang.dk/rgbgradient/ */
td.coverage00 { background-color: #FF0000; }
td.coverage10 { background-color: #F83100; }
td.coverage20 { background-color: #F25F00; }
td.coverage30 { background-color: #EB8B00; }
td.coverage40 { background-color: #E5B500; }
td.coverage50 { background-color: #DFDC00; }
td.coverage60 { background-color: #B0D800; }
td.coverage70 { background-color: #81D200; }
td.coverage80 { background-color: #55CB00; }
td.coverage90 { background-color: #2CC500; }
td.coverage100 { background-color: #04BF00; }
</style><p>This file was read by GAP before profiling was actived, so lines which were not read but not executed are not marked.</p><table class="sortable">
<thead><tr><th>Line</th><th>Execs</th><th>Time</th><th>Time+Childs</th><th>Code</th><th>Called Functions</th>
</tr></thead>
<tbody>
<tr class='ignore'><td><a name="line1"></a><div class='linenum'>1</div></td><td></td><td></td><td></td><td><span><tt>#############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line2"></a><div class='linenum'>2</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line3"></a><div class='linenum'>3</div></td><td></td><td></td><td></td><td><span><tt>#W&nbsp;&nbsp;primality.gi&nbsp;&nbsp;&nbsp;&nbsp;GAP&nbsp;library&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jack&nbsp;Schmidt
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line4"></a><div class='linenum'>4</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line5"></a><div class='linenum'>5</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line6"></a><div class='linenum'>6</div></td><td></td><td></td><td></td><td><span><tt>#Y&nbsp;&nbsp;Copyright&nbsp;(C)&nbsp;&nbsp;2005&nbsp;Jack&nbsp;Schmidt
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line7"></a><div class='linenum'>7</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line8"></a><div class='linenum'>8</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;This&nbsp;file&nbsp;contains&nbsp;declarations&nbsp;for&nbsp;the&nbsp;primality&nbsp;test&nbsp;in&nbsp;the&nbsp;integers.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line9"></a><div class='linenum'>9</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line10"></a><div class='linenum'>10</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line11"></a><div class='linenum'>11</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;This&nbsp;file&nbsp;is&nbsp;meant&nbsp;to&nbsp;improve&nbsp;the&nbsp;primality&nbsp;testing&nbsp;in&nbsp;GAP&nbsp;in&nbsp;two
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line12"></a><div class='linenum'>12</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;significant&nbsp;ways.&nbsp;(1)&nbsp;IsProbablyPrimeInt&nbsp;has&nbsp;been&nbsp;sped&nbsp;up,&nbsp;and&nbsp;perhaps
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line13"></a><div class='linenum'>13</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;been&nbsp;better&nbsp;documented.&nbsp;(2)&nbsp;IsPrimeInt&nbsp;can&nbsp;now&nbsp;use&nbsp;N+-1&nbsp;primality&nbsp;proving
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line14"></a><div class='linenum'>14</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;algorithms&nbsp;to&nbsp;prove&nbsp;primality&nbsp;(proofs&nbsp;can&nbsp;be&nbsp;produced&nbsp;for&nbsp;all&nbsp;primes
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line15"></a><div class='linenum'>15</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;less&nbsp;than&nbsp;10^18,&nbsp;and&nbsp;for&nbsp;most&nbsp;primes&nbsp;up&nbsp;to&nbsp;10^50&nbsp;or&nbsp;more).&nbsp;A&nbsp;proof
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line16"></a><div class='linenum'>16</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;verifier&nbsp;is&nbsp;included&nbsp;to&nbsp;demonstrate&nbsp;the&nbsp;simplicity&nbsp;of&nbsp;the&nbsp;proofs.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line17"></a><div class='linenum'>17</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line18"></a><div class='linenum'>18</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;This&nbsp;file&nbsp;is&nbsp;split&nbsp;into&nbsp;five&nbsp;parts.&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line19"></a><div class='linenum'>19</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line20"></a><div class='linenum'>20</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(1)&nbsp;Prerequisites,&nbsp;including&nbsp;efficient&nbsp;IsSquareInt
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line21"></a><div class='linenum'>21</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;routine.&nbsp;Some&nbsp;short&nbsp;tables&nbsp;are&nbsp;also&nbsp;included.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line22"></a><div class='linenum'>22</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line23"></a><div class='linenum'>23</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(2)&nbsp;The&nbsp;optimized&nbsp;Baillie-Pomerance-Selfridge-Wagstaff
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line24"></a><div class='linenum'>24</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;pseudoprimality&nbsp;test&nbsp;with&nbsp;subtests&nbsp;properly&nbsp;labelled&nbsp;and&nbsp;explained,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line25"></a><div class='linenum'>25</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;and&nbsp;bounds&nbsp;given&nbsp;at&nbsp;a&nbsp;more&nbsp;precise&nbsp;level.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line26"></a><div class='linenum'>26</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line27"></a><div class='linenum'>27</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(3)&nbsp;The&nbsp;primality&nbsp;proof&nbsp;production&nbsp;code,&nbsp;which&nbsp;finds&nbsp;a&nbsp;machine
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line28"></a><div class='linenum'>28</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;verifiable&nbsp;proof&nbsp;for&nbsp;the&nbsp;primality&nbsp;of&nbsp;a&nbsp;(probable)&nbsp;prime.&nbsp;It&nbsp;is
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line29"></a><div class='linenum'>29</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;based&nbsp;on&nbsp;the&nbsp;paper&nbsp;Brillhart,&nbsp;Lehmer,&nbsp;Selfridge's&nbsp;"New&nbsp;Primality
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line30"></a><div class='linenum'>30</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Criteria&nbsp;and&nbsp;Factorizations&nbsp;of&nbsp;2^m&nbsp;+-1",&nbsp;1975,&nbsp;hereafter&nbsp;referred
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line31"></a><div class='linenum'>31</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;to&nbsp;as&nbsp;BLS1975.&nbsp;This&nbsp;paper&nbsp;is&nbsp;available&nbsp;on&nbsp;JSTOR&nbsp;and&nbsp;is&nbsp;very&nbsp;clearly
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line32"></a><div class='linenum'>32</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;written.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line33"></a><div class='linenum'>33</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line34"></a><div class='linenum'>34</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(4)&nbsp;The&nbsp;primality&nbsp;proof&nbsp;verifier,&nbsp;which&nbsp;detects&nbsp;if&nbsp;the&nbsp;proposed
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line35"></a><div class='linenum'>35</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;proof&nbsp;in&nbsp;fact&nbsp;satisfies&nbsp;the&nbsp;conditions&nbsp;of&nbsp;one&nbsp;of&nbsp;the&nbsp;results&nbsp;in&nbsp;BLS1975.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line36"></a><div class='linenum'>36</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line37"></a><div class='linenum'>37</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(5)&nbsp;A&nbsp;pretty&nbsp;interface&nbsp;to&nbsp;GAP,&nbsp;with&nbsp;result&nbsp;caching&nbsp;and&nbsp;warnings&nbsp;in
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line38"></a><div class='linenum'>38</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;the&nbsp;rare&nbsp;event&nbsp;IsPrimeInt&nbsp;is&nbsp;unable&nbsp;to&nbsp;prove&nbsp;primality.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line39"></a><div class='linenum'>39</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line40"></a><div class='linenum'>40</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;Further&nbsp;work:&nbsp;The&nbsp;following&nbsp;would&nbsp;be&nbsp;good&nbsp;future&nbsp;tasks&nbsp;for&nbsp;the
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line41"></a><div class='linenum'>41</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;interested&nbsp;developer:
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line42"></a><div class='linenum'>42</div></td><td></td><td></td><td></td><td><span><tt>#T
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line43"></a><div class='linenum'>43</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;(1)&nbsp;Recursive&nbsp;verification:&nbsp;It&nbsp;is&nbsp;standard&nbsp;for&nbsp;primality&nbsp;proofs
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line44"></a><div class='linenum'>44</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;to&nbsp;require&nbsp;"lemmas"&nbsp;where&nbsp;other&nbsp;numbers&nbsp;are&nbsp;proved&nbsp;prime&nbsp;as&nbsp;well.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line45"></a><div class='linenum'>45</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;Currently&nbsp;I&nbsp;make&nbsp;no&nbsp;use&nbsp;of&nbsp;this&nbsp;(and&nbsp;it&nbsp;is&nbsp;not&nbsp;needed&nbsp;for&nbsp;N&nbsp;&lt;&nbsp;10^18)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line46"></a><div class='linenum'>46</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;so&nbsp;it&nbsp;is&nbsp;not&nbsp;implemented.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line47"></a><div class='linenum'>47</div></td><td></td><td></td><td></td><td><span><tt>#T
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line48"></a><div class='linenum'>48</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;(2)&nbsp;Theoretical&nbsp;extensions&nbsp;of&nbsp;BLS1975:&nbsp;one&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;more
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line49"></a><div class='linenum'>49</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;carefully&nbsp;handle&nbsp;the&nbsp;case&nbsp;of&nbsp;multiple&nbsp;composite&nbsp;factors&nbsp;of&nbsp;N+-1
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line50"></a><div class='linenum'>50</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;in&nbsp;the&nbsp;earlier&nbsp;portions&nbsp;of&nbsp;the&nbsp;paper,&nbsp;to&nbsp;bring&nbsp;results&nbsp;like&nbsp;Theorem&nbsp;21
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line51"></a><div class='linenum'>51</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;into&nbsp;wider&nbsp;use.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line52"></a><div class='linenum'>52</div></td><td></td><td></td><td></td><td><span><tt>#T
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line53"></a><div class='linenum'>53</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;(3)&nbsp;Other&nbsp;tests:&nbsp;One&nbsp;can&nbsp;easily&nbsp;verify&nbsp;ECPP&nbsp;machine&nbsp;proofs,&nbsp;and&nbsp;they
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line54"></a><div class='linenum'>54</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;can&nbsp;coexist&nbsp;in&nbsp;the&nbsp;current&nbsp;format.&nbsp;Unfortunately&nbsp;finding&nbsp;ECPP&nbsp;proofs
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line55"></a><div class='linenum'>55</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;is&nbsp;a&nbsp;difficult&nbsp;task.&nbsp;Another&nbsp;test,&nbsp;the&nbsp;APRCL,&nbsp;might&nbsp;also&nbsp;be&nbsp;suitable.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line56"></a><div class='linenum'>56</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;However,&nbsp;verification&nbsp;of&nbsp;its&nbsp;certificates&nbsp;is&nbsp;extremely&nbsp;complex&nbsp;and
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line57"></a><div class='linenum'>57</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;some&nbsp;experts&nbsp;warn&nbsp;"the&nbsp;probability&nbsp;of&nbsp;an&nbsp;implementation&nbsp;error&nbsp;in&nbsp;the
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line58"></a><div class='linenum'>58</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;verification&nbsp;routine&nbsp;is&nbsp;much&nbsp;higher&nbsp;than&nbsp;the&nbsp;probability&nbsp;that&nbsp;a&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line59"></a><div class='linenum'>59</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;composite&nbsp;BPSW&nbsp;is&nbsp;found".&nbsp;GAP&nbsp;does&nbsp;have&nbsp;rudimentary&nbsp;support&nbsp;for&nbsp;the
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line60"></a><div class='linenum'>60</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;needed&nbsp;algebraic&nbsp;structures,&nbsp;but&nbsp;initial&nbsp;testing&nbsp;shows&nbsp;the&nbsp;overhead
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line61"></a><div class='linenum'>61</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;of&nbsp;arithmetic&nbsp;in&nbsp;these&nbsp;rings&nbsp;is&nbsp;an&nbsp;insurmountable&nbsp;obstacle&nbsp;for&nbsp;N&nbsp;in
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line62"></a><div class='linenum'>62</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;in&nbsp;the&nbsp;appropriate&nbsp;range.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line63"></a><div class='linenum'>63</div></td><td></td><td></td><td></td><td><span><tt>#T
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line64"></a><div class='linenum'>64</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;(4)&nbsp;Direct&nbsp;interface&nbsp;to&nbsp;PARI-lib.&nbsp;For&nbsp;a&nbsp;number&nbsp;of&nbsp;reasons,&nbsp;it&nbsp;might
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line65"></a><div class='linenum'>65</div></td><td></td><td></td><td></td><td><span><tt>#T&nbsp;&nbsp;be&nbsp;advantageous&nbsp;to&nbsp;allow&nbsp;use&nbsp;of&nbsp;PARI&nbsp;from&nbsp;within&nbsp;GAP.&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line66"></a><div class='linenum'>66</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line67"></a><div class='linenum'>67</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Testing:&nbsp;All&nbsp;primes&nbsp;&lt;&nbsp;10^7&nbsp;tested.&nbsp;All&nbsp;236021&nbsp;"Brent&nbsp;factors"&nbsp;tested,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line68"></a><div class='linenum'>68</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;but&nbsp;two&nbsp;such&nbsp;primes&nbsp;could&nbsp;not&nbsp;be&nbsp;proven&nbsp;prime&nbsp;(1.8*10^104&nbsp;and&nbsp;3.2*10^86).&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line69"></a><div class='linenum'>69</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line70"></a><div class='linenum'>70</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line71"></a><div class='linenum'>71</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line72"></a><div class='linenum'>72</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line73"></a><div class='linenum'>73</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line74"></a><div class='linenum'>74</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Section&nbsp;1:&nbsp;Prerequisites
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line75"></a><div class='linenum'>75</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line76"></a><div class='linenum'>76</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(a)&nbsp;record&nbsp;our&nbsp;tables&nbsp;of&nbsp;small&nbsp;primes&nbsp;and&nbsp;pseudoprimes
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line77"></a><div class='linenum'>77</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(b)&nbsp;Define&nbsp;IsSquareInt
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line78"></a><div class='linenum'>78</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line79"></a><div class='linenum'>79</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line80"></a><div class='linenum'>80</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line81"></a><div class='linenum'>81</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line82"></a><div class='linenum'>82</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line83"></a><div class='linenum'>83</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line84"></a><div class='linenum'>84</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Tables&nbsp;-&nbsp;We&nbsp;define&nbsp;a&nbsp;table
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line85"></a><div class='linenum'>85</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;CompositeSPP2&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line86"></a><div class='linenum'>86</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;the&nbsp;composite&nbsp;numbers&nbsp;&lt;&nbsp;10^7&nbsp;that&nbsp;are&nbsp;strong&nbsp;pseudoprimes&nbsp;for&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line87"></a><div class='linenum'>87</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;base&nbsp;2,&nbsp;and&nbsp;that&nbsp;have&nbsp;no&nbsp;prime&nbsp;factors&nbsp;&lt;&nbsp;1000.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line88"></a><div class='linenum'>88</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line89"></a><div class='linenum'>89</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line90"></a><div class='linenum'>90</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line91"></a><div class='linenum'>91</div></td><td></td><td></td><td></td><td><span><tt>InstallValue(CompositeSPP2,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line92"></a><div class='linenum'>92</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;[&nbsp;1194649,&nbsp;1678541,&nbsp;2284453,&nbsp;2304167,&nbsp;3090091,&nbsp;3125281,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line93"></a><div class='linenum'>93</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;3375041,&nbsp;3400013,&nbsp;3898129,&nbsp;4181921,&nbsp;4360621,&nbsp;4469471,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line94"></a><div class='linenum'>94</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;4513841,&nbsp;4863127,&nbsp;5044033,&nbsp;5173169,&nbsp;5489641,&nbsp;5919187,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line95"></a><div class='linenum'>95</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;6226193,&nbsp;6233977,&nbsp;6368689,&nbsp;6787327,&nbsp;6952037,&nbsp;7306261,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line96"></a><div class='linenum'>96</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;7306561,&nbsp;7820201,&nbsp;8036033,&nbsp;8095447,&nbsp;8725753,&nbsp;9006401,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line97"></a><div class='linenum'>97</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;9056501,&nbsp;9371251,&nbsp;9729301,&nbsp;9863461&nbsp;]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line98"></a><div class='linenum'>98</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line99"></a><div class='linenum'>99</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line100"></a><div class='linenum'>100</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line101"></a><div class='linenum'>101</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Caches&nbsp;-&nbsp;install&nbsp;flushable&nbsp;values&nbsp;into&nbsp;the&nbsp;cache&nbsp;if&nbsp;they&nbsp;are&nbsp;not&nbsp;already
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line102"></a><div class='linenum'>102</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;installed.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line103"></a><div class='linenum'>103</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line104"></a><div class='linenum'>104</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line105"></a><div class='linenum'>105</div></td><td></td><td></td><td></td><td><span><tt>InstallFlushableValue(PrimesProofs,[]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line106"></a><div class='linenum'>106</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line107"></a><div class='linenum'>107</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line108"></a><div class='linenum'>108</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line109"></a><div class='linenum'>109</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;IsSquareInt&nbsp;-&nbsp;Check&nbsp;if&nbsp;an&nbsp;integer&nbsp;is&nbsp;a&nbsp;square
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line110"></a><div class='linenum'>110</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line111"></a><div class='linenum'>111</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Simple&nbsp;implemenation&nbsp;based&nbsp;on&nbsp;the&nbsp;ideas&nbsp;in&nbsp;Cohen's&nbsp;CCANT,&nbsp;Algorithm&nbsp;1.7.3.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line112"></a><div class='linenum'>112</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Briefly,&nbsp;check&nbsp;if&nbsp;N&nbsp;is&nbsp;a&nbsp;quadratic&nbsp;residue&nbsp;modulo&nbsp;some&nbsp;small&nbsp;prime&nbsp;powers,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line113"></a><div class='linenum'>113</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;then&nbsp;test&nbsp;if&nbsp;it&nbsp;is&nbsp;equal&nbsp;to&nbsp;the&nbsp;square&nbsp;of&nbsp;its&nbsp;integer&nbsp;square&nbsp;root.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line114"></a><div class='linenum'>114</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line115"></a><div class='linenum'>115</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Please&nbsp;note:&nbsp;This&nbsp;is&nbsp;unimaginably&nbsp;faster&nbsp;than&nbsp;the&nbsp;simpler&nbsp;RootInt(n)^2=n
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line116"></a><div class='linenum'>116</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;because&nbsp;of&nbsp;the&nbsp;initial&nbsp;residue&nbsp;tests.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line117"></a><div class='linenum'>117</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line118"></a><div class='linenum'>118</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line119"></a><div class='linenum'>119</div></td><td></td><td></td><td></td><td><span><tt>InstallValue(CCANT_1_7_3_q11,List([1..11],i->0));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line120"></a><div class='linenum'>120</div></td><td></td><td></td><td></td><td><span><tt>InstallValue(CCANT_1_7_3_q63,List([1..63],i->0));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line121"></a><div class='linenum'>121</div></td><td></td><td></td><td></td><td><span><tt>InstallValue(CCANT_1_7_3_q64,List([1..64],i->0));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line122"></a><div class='linenum'>122</div></td><td></td><td></td><td></td><td><span><tt>InstallValue(CCANT_1_7_3_q65,List([1..65],i->0));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line123"></a><div class='linenum'>123</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line124"></a><div class='linenum'>124</div></td><td></td><td></td><td></td><td><span><tt>BindGlobal("CCANT_1_7_3",
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line125"></a><div class='linenum'>125</div></td><td></td><td></td><td></td><td><span><tt>function(n)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line126"></a><div class='linenum'>126</div></td><td></td><td></td><td></td><td><span><tt>local&nbsp;t,r,q;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line127"></a><div class='linenum'>127</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;n&nbsp;&lt;&nbsp;0&nbsp;then&nbsp;return&nbsp;false;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line128"></a><div class='linenum'>128</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;CCANT_1_7_3_q11[1]=0&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line129"></a><div class='linenum'>129</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#initialize
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line130"></a><div class='linenum'>130</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;t&nbsp;in&nbsp;[0..32]&nbsp;do
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line131"></a><div class='linenum'>131</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CCANT_1_7_3_q11[(t^2&nbsp;mod&nbsp;11)+1]:=1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line132"></a><div class='linenum'>132</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CCANT_1_7_3_q63[(t^2&nbsp;mod&nbsp;63)+1]:=1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line133"></a><div class='linenum'>133</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CCANT_1_7_3_q64[(t^2&nbsp;mod&nbsp;64)+1]:=1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line134"></a><div class='linenum'>134</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CCANT_1_7_3_q65[(t^2&nbsp;mod&nbsp;65)+1]:=1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line135"></a><div class='linenum'>135</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line136"></a><div class='linenum'>136</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line137"></a><div class='linenum'>137</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line138"></a><div class='linenum'>138</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;t:=&nbsp;n&nbsp;mod&nbsp;64;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line139"></a><div class='linenum'>139</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if(CCANT_1_7_3_q64[t+1]=0)&nbsp;then&nbsp;return&nbsp;false;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line140"></a><div class='linenum'>140</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;r:=&nbsp;n&nbsp;mod&nbsp;45045;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line141"></a><div class='linenum'>141</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if(CCANT_1_7_3_q63[(r&nbsp;mod&nbsp;63)+1]=0)&nbsp;then&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line142"></a><div class='linenum'>142</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif(CCANT_1_7_3_q65[(r&nbsp;mod&nbsp;65)+1]=0)&nbsp;then&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line143"></a><div class='linenum'>143</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif(CCANT_1_7_3_q11[(r&nbsp;mod&nbsp;11)+1]=0)&nbsp;then&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line144"></a><div class='linenum'>144</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;else&nbsp;q:=RootInt(n);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line145"></a><div class='linenum'>145</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;n=q^2;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line146"></a><div class='linenum'>146</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line147"></a><div class='linenum'>147</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line148"></a><div class='linenum'>148</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line149"></a><div class='linenum'>149</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(IsSquareInt,CCANT_1_7_3);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line150"></a><div class='linenum'>150</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line151"></a><div class='linenum'>151</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line152"></a><div class='linenum'>152</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line153"></a><div class='linenum'>153</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line154"></a><div class='linenum'>154</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line155"></a><div class='linenum'>155</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;LucasMod(P,Q,N,k)&nbsp;-&nbsp;return&nbsp;the&nbsp;reduction&nbsp;modulo&nbsp;N&nbsp;of&nbsp;the&nbsp;k'th&nbsp;terms&nbsp;of&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line156"></a><div class='linenum'>156</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;the&nbsp;Lucas&nbsp;Sequences&nbsp;U,V&nbsp;associated&nbsp;to&nbsp;x^2+Px+Q.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line157"></a><div class='linenum'>157</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line158"></a><div class='linenum'>158</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Iterative&nbsp;version&nbsp;allows&nbsp;larger&nbsp;k&nbsp;(better=constant&nbsp;in&nbsp;N)&nbsp;memory&nbsp;use&nbsp;and
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line159"></a><div class='linenum'>159</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;is&nbsp;about&nbsp;twice&nbsp;as&nbsp;fast&nbsp;as&nbsp;the&nbsp;recursive&nbsp;version&nbsp;for&nbsp;k&nbsp;around&nbsp;1000.&nbsp;This
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line160"></a><div class='linenum'>160</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;should&nbsp;be&nbsp;callable&nbsp;for&nbsp;k&nbsp;around&nbsp;2^100000&nbsp;or&nbsp;so&nbsp;(runtime&nbsp;is&nbsp;log(k)),&nbsp;but
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line161"></a><div class='linenum'>161</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;the&nbsp;size&nbsp;of&nbsp;N&nbsp;is&nbsp;the&nbsp;biggest&nbsp;concern.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line162"></a><div class='linenum'>162</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line163"></a><div class='linenum'>163</div></td><td></td><td></td><td></td><td><span><tt>InstallMethod(LucasMod,&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line164"></a><div class='linenum'>164</div></td><td></td><td></td><td></td><td><span><tt>"iterative&nbsp;method",
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line165"></a><div class='linenum'>165</div></td><td></td><td></td><td></td><td><span><tt>[IsInt,IsInt,IsInt,IsInt],
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line166"></a><div class='linenum'>166</div></td><td></td><td></td><td></td><td><span><tt>1,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line167"></a><div class='linenum'>167</div></td><td></td><td></td><td></td><td><span><tt>function(P,Q,N,K)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line168"></a><div class='linenum'>168</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;local&nbsp;Um,Vm,Qm,U2m,V2m,Q2m,U2mp1,V2mp1,Q2mp1,k,s,d,i,P2m4Q,T;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line169"></a><div class='linenum'>169</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;P2m4Q&nbsp;:=&nbsp;P*P-4*Q;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line170"></a><div class='linenum'>170</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;SignInt(K);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line171"></a><div class='linenum'>171</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;:=&nbsp;AbsInt(K);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line172"></a><div class='linenum'>172</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;:=&nbsp;LogInt(k+1,2);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line173"></a><div class='linenum'>173</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;:=&nbsp;2^d;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line174"></a><div class='linenum'>174</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;Um&nbsp;:=&nbsp;0;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line175"></a><div class='linenum'>175</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;Vm&nbsp;:=&nbsp;2&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line176"></a><div class='linenum'>176</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;Qm&nbsp;:=&nbsp;1&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line177"></a><div class='linenum'>177</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;[d,d-1..0]&nbsp;do
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line178"></a><div class='linenum'>178</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;T&nbsp;=&nbsp;2^i
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line179"></a><div class='linenum'>179</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;k&nbsp;is&nbsp;the&nbsp;0&nbsp;through&nbsp;i'th&nbsp;least&nbsp;significant&nbsp;bits&nbsp;of&nbsp;|K|
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line180"></a><div class='linenum'>180</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;"T&nbsp;&lt;=&nbsp;k"&nbsp;means&nbsp;the&nbsp;i'th&nbsp;bit&nbsp;of&nbsp;|K|&nbsp;is&nbsp;set.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line181"></a><div class='linenum'>181</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;we&nbsp;have&nbsp;found&nbsp;[Um,Vm,Qm]=Lucas(P,Q,m)&nbsp;for&nbsp;m&nbsp;=&nbsp;QuoInt(|K|,2*T),
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line182"></a><div class='linenum'>182</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;then&nbsp;we&nbsp;can&nbsp;find&nbsp;[Un,Vn,Qn]=Lucas(P,Q,n)&nbsp;for&nbsp;n&nbsp;=&nbsp;QuoInt(|K|,T)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line183"></a><div class='linenum'>183</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;using&nbsp;n&nbsp;=&nbsp;2*m&nbsp;+&nbsp;(i'th&nbsp;bit&nbsp;of&nbsp;|K|&nbsp;is&nbsp;set)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line184"></a><div class='linenum'>184</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U2m&nbsp;:=&nbsp;Um*Vm&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line185"></a><div class='linenum'>185</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V2m&nbsp;:=&nbsp;(Vm*Vm&nbsp;-&nbsp;2*Qm)&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line186"></a><div class='linenum'>186</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2m&nbsp;:=&nbsp;Qm*Qm&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line187"></a><div class='linenum'>187</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;T&nbsp;&lt;=&nbsp;k&nbsp;then&nbsp;#&nbsp;replace&nbsp;m&nbsp;with&nbsp;n&nbsp;=&nbsp;2m+1
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line188"></a><div class='linenum'>188</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U2mp1&nbsp;:=&nbsp;(P*U2m&nbsp;+&nbsp;V2m)/2&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line189"></a><div class='linenum'>189</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V2mp1&nbsp;:=&nbsp;(P2m4Q*U2m&nbsp;+&nbsp;P*V2m)/2&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line190"></a><div class='linenum'>190</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2mp1&nbsp;:=&nbsp;Q2m*Q&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line191"></a><div class='linenum'>191</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Um&nbsp;:=&nbsp;U2mp1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line192"></a><div class='linenum'>192</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vm&nbsp;:=&nbsp;V2mp1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line193"></a><div class='linenum'>193</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qm&nbsp;:=&nbsp;Q2mp1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line194"></a><div class='linenum'>194</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;:=&nbsp;k&nbsp;-&nbsp;T;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line195"></a><div class='linenum'>195</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;#&nbsp;replace&nbsp;m&nbsp;with&nbsp;n&nbsp;=&nbsp;2m
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line196"></a><div class='linenum'>196</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Um&nbsp;:=&nbsp;U2m;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line197"></a><div class='linenum'>197</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vm&nbsp;:=&nbsp;V2m;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line198"></a><div class='linenum'>198</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qm&nbsp;:=&nbsp;Q2m;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line199"></a><div class='linenum'>199</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line200"></a><div class='linenum'>200</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;:=&nbsp;T/2;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line201"></a><div class='linenum'>201</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line202"></a><div class='linenum'>202</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;s&nbsp;&lt;&nbsp;0&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line203"></a><div class='linenum'>203</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Um&nbsp;:=&nbsp;-Um/Qm&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line204"></a><div class='linenum'>204</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vm&nbsp;:=&nbsp;Vm/Qm&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line205"></a><div class='linenum'>205</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Qm&nbsp;:=&nbsp;1/Qm&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line206"></a><div class='linenum'>206</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line207"></a><div class='linenum'>207</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[Um,Vm,Qm];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line208"></a><div class='linenum'>208</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line209"></a><div class='linenum'>209</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line210"></a><div class='linenum'>210</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line211"></a><div class='linenum'>211</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line212"></a><div class='linenum'>212</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line213"></a><div class='linenum'>213</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Section&nbsp;2:&nbsp;Baillie-Pomerance-Selfridge-Wagstaff&nbsp;pseudoprimality&nbsp;test
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line214"></a><div class='linenum'>214</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line215"></a><div class='linenum'>215</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(1)&nbsp;IsStrongPseudoPrimeBaseA
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line216"></a><div class='linenum'>216</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(2)&nbsp;IsLucasPseudoPrime&nbsp;(the&nbsp;BPSW&nbsp;version&nbsp;with&nbsp;hardcoded&nbsp;discriminant)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line217"></a><div class='linenum'>217</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(3)&nbsp;IsBPSWPsuedoPrime&nbsp;-&nbsp;main&nbsp;interface&nbsp;to&nbsp;optimized&nbsp;test
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line218"></a><div class='linenum'>218</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line219"></a><div class='linenum'>219</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line220"></a><div class='linenum'>220</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line221"></a><div class='linenum'>221</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line222"></a><div class='linenum'>222</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line223"></a><div class='linenum'>223</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line224"></a><div class='linenum'>224</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;IsStrongPseudoPrimeBaseA(N,A)&nbsp;-&nbsp;If&nbsp;A&nbsp;does&nbsp;not&nbsp;have&nbsp;odd&nbsp;multiplicative
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line225"></a><div class='linenum'>225</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;order&nbsp;mod&nbsp;N,&nbsp;then&nbsp;check&nbsp;-1&nbsp;in&nbsp;&lt;A>.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line226"></a><div class='linenum'>226</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line227"></a><div class='linenum'>227</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line228"></a><div class='linenum'>228</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(IsStrongPseudoPrimeBaseA,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line229"></a><div class='linenum'>229</div></td><td></td><td></td><td></td><td><span><tt>function(n,A)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line230"></a><div class='linenum'>230</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;e,o,i,x;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line231"></a><div class='linenum'>231</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;find&nbsp;$e$&nbsp;and&nbsp;$o$&nbsp;odd&nbsp;such&nbsp;that&nbsp;$n-1&nbsp;=&nbsp;2^e&nbsp;*&nbsp;o$
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line232"></a><div class='linenum'>232</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;e&nbsp;:=&nbsp;0;&nbsp;o&nbsp;:=&nbsp;n-1;&nbsp;&nbsp;&nbsp;while&nbsp;o&nbsp;mod&nbsp;2&nbsp;=&nbsp;0&nbsp;do&nbsp;e&nbsp;:=&nbsp;e+1;&nbsp;o&nbsp;:=&nbsp;o/2;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line233"></a><div class='linenum'>233</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;look&nbsp;at&nbsp;the&nbsp;seq&nbsp;$A^o,&nbsp;A^{2&nbsp;o},&nbsp;A^{4&nbsp;o},&nbsp;..,&nbsp;A^{2^e&nbsp;o}=A^{n-1}$
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line234"></a><div class='linenum'>234</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;x&nbsp;:=&nbsp;PowerModInt(&nbsp;A,&nbsp;o,&nbsp;n&nbsp;);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line235"></a><div class='linenum'>235</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;i&nbsp;:=&nbsp;0;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line236"></a><div class='linenum'>236</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;while&nbsp;i&nbsp;&lt;&nbsp;e&nbsp;and&nbsp;x&nbsp;&lt;>&nbsp;1&nbsp;and&nbsp;x&nbsp;&lt;>&nbsp;n-1&nbsp;do
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line237"></a><div class='linenum'>237</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;:=&nbsp;x&nbsp;*&nbsp;x&nbsp;mod&nbsp;n;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line238"></a><div class='linenum'>238</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;:=&nbsp;i&nbsp;+&nbsp;1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line239"></a><div class='linenum'>239</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line240"></a><div class='linenum'>240</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;of&nbsp;the&nbsp;form&nbsp;$..,&nbsp;-1,&nbsp;1,&nbsp;1,&nbsp;..$&nbsp;then&nbsp;$n$&nbsp;is&nbsp;composite
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line241"></a><div class='linenum'>241</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;(x&nbsp;=&nbsp;n-1&nbsp;or&nbsp;(i&nbsp;=&nbsp;0&nbsp;and&nbsp;x&nbsp;=&nbsp;1));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line242"></a><div class='linenum'>242</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line243"></a><div class='linenum'>243</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line244"></a><div class='linenum'>244</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line245"></a><div class='linenum'>245</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line246"></a><div class='linenum'>246</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;IsBPSWLucasPseudoPrime(N)&nbsp;-&nbsp;Check&nbsp;if&nbsp;N&nbsp;is&nbsp;a&nbsp;Lucas&nbsp;pseudoprime&nbsp;for&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line247"></a><div class='linenum'>247</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;x^2+P*x+1&nbsp;where&nbsp;P&nbsp;is&nbsp;the&nbsp;smallest&nbsp;positive&nbsp;integer&nbsp;such&nbsp;that&nbsp;P^2&nbsp;-&nbsp;4&nbsp;is&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line248"></a><div class='linenum'>248</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;not&nbsp;a&nbsp;square&nbsp;mod&nbsp;N.&nbsp;N&nbsp;should&nbsp;be&nbsp;odd.&nbsp;N&nbsp;should&nbsp;be&nbsp;prime&nbsp;or&nbsp;greater
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line249"></a><div class='linenum'>249</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;than&nbsp;100.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line250"></a><div class='linenum'>250</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line251"></a><div class='linenum'>251</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line252"></a><div class='linenum'>252</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(IsBPSWLucasPseudoPrime,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line253"></a><div class='linenum'>253</div></td><td></td><td></td><td></td><td><span><tt>function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line254"></a><div class='linenum'>254</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;P;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line255"></a><div class='linenum'>255</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;N&nbsp;=&nbsp;2&nbsp;then&nbsp;return&nbsp;true;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line256"></a><div class='linenum'>256</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;IsSquareInt(N)&nbsp;or&nbsp;IsEvenInt(N)&nbsp;then&nbsp;return&nbsp;false;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line257"></a><div class='linenum'>257</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;P:=2;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line258"></a><div class='linenum'>258</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;while&nbsp;Jacobi(&nbsp;P^2-4,&nbsp;N&nbsp;)&nbsp;&lt;>&nbsp;-1&nbsp;do&nbsp;P:=(P+1)&nbsp;mod&nbsp;N;&nbsp;if&nbsp;P&nbsp;=&nbsp;2&nbsp;then&nbsp;return&nbsp;fail;&nbsp;fi;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line259"></a><div class='linenum'>259</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;TraceModQF(P,N+1,N)&nbsp;=&nbsp;[2,P];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line260"></a><div class='linenum'>260</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line261"></a><div class='linenum'>261</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line262"></a><div class='linenum'>262</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;There&nbsp;are&nbsp;several&nbsp;variations&nbsp;on&nbsp;how&nbsp;to&nbsp;choose&nbsp;the&nbsp;parameters&nbsp;for&nbsp;the&nbsp;Lucas
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line263"></a><div class='linenum'>263</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;test.&nbsp;The&nbsp;first&nbsp;two&nbsp;are&nbsp;based&nbsp;on&nbsp;PSW1980,&nbsp;p1024,&nbsp;and&nbsp;are&nbsp;also&nbsp;found&nbsp;in
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line264"></a><div class='linenum'>264</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;BW1980,&nbsp;p1401.&nbsp;The&nbsp;next&nbsp;two&nbsp;parameter&nbsp;choices&nbsp;are&nbsp;from&nbsp;BW1980&nbsp;p1409.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line265"></a><div class='linenum'>265</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;The&nbsp;next&nbsp;is&nbsp;reported&nbsp;to&nbsp;be&nbsp;a&nbsp;suggestion&nbsp;of&nbsp;Wei&nbsp;Dei.&nbsp;The&nbsp;final&nbsp;is&nbsp;the&nbsp;version
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line266"></a><div class='linenum'>266</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;used&nbsp;by&nbsp;GAP,&nbsp;which&nbsp;was&nbsp;the&nbsp;fastest&nbsp;in&nbsp;the&nbsp;tests&nbsp;I&nbsp;ran.&nbsp;GAP&nbsp;was&nbsp;5%&nbsp;faster
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line267"></a><div class='linenum'>267</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;than&nbsp;the&nbsp;fastest&nbsp;of&nbsp;the&nbsp;other&nbsp;variants,&nbsp;and&nbsp;with&nbsp;TraceModQF&nbsp;function,&nbsp;was
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line268"></a><div class='linenum'>268</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;twice&nbsp;as&nbsp;fast.&nbsp;Therefore&nbsp;the&nbsp;following&nbsp;code&nbsp;is&nbsp;simply&nbsp;commented&nbsp;out,&nbsp;and
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line269"></a><div class='linenum'>269</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;the&nbsp;hard-wired&nbsp;version&nbsp;left.&nbsp;JS
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line270"></a><div class='linenum'>270</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line271"></a><div class='linenum'>271</div></td><td></td><td></td><td></td><td><span><tt>#BPSWLucasParameters_PSW1980_A&nbsp;:=&nbsp;function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line272"></a><div class='linenum'>272</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;local&nbsp;D,o;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line273"></a><div class='linenum'>273</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;D:=5;&nbsp;o:=1;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line274"></a><div class='linenum'>274</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;while&nbsp;Jacobi(D,N)&nbsp;&lt;>&nbsp;-1&nbsp;do&nbsp;D:=(-D-2*o)&nbsp;mod&nbsp;N;&nbsp;o:=-o;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line275"></a><div class='linenum'>275</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;return&nbsp;[D,1,(1-D)/4&nbsp;mod&nbsp;N];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line276"></a><div class='linenum'>276</div></td><td></td><td></td><td></td><td><span><tt>#end;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line277"></a><div class='linenum'>277</div></td><td></td><td></td><td></td><td><span><tt>#BPSWLucasParameters_PSW1980_B&nbsp;:=&nbsp;function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line278"></a><div class='linenum'>278</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;local&nbsp;D,P;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line279"></a><div class='linenum'>279</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;D:=5;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line280"></a><div class='linenum'>280</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;while&nbsp;Jacobi(D,N)&nbsp;&lt;>&nbsp;-1&nbsp;do&nbsp;D:=D+4;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line281"></a><div class='linenum'>281</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;P:=RootInt(D);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line282"></a><div class='linenum'>282</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;P:=P&nbsp;+&nbsp;((P+1)&nbsp;mod&nbsp;2);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line283"></a><div class='linenum'>283</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;while&nbsp;P^2&nbsp;&lt;&nbsp;D&nbsp;do&nbsp;P:=P+2;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line284"></a><div class='linenum'>284</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;return&nbsp;[D&nbsp;mod&nbsp;N,P&nbsp;mod&nbsp;N,(P^2-D)/4&nbsp;mod&nbsp;N];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line285"></a><div class='linenum'>285</div></td><td></td><td></td><td></td><td><span><tt>#end;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line286"></a><div class='linenum'>286</div></td><td></td><td></td><td></td><td><span><tt>#BPSWLucasParameters_BW1980_Astar&nbsp;:=&nbsp;function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line287"></a><div class='linenum'>287</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;local&nbsp;D,o;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line288"></a><div class='linenum'>288</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;D:=5;&nbsp;o:=1;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line289"></a><div class='linenum'>289</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;while&nbsp;Jacobi(D,N)&nbsp;&lt;>&nbsp;-1&nbsp;do&nbsp;D:=(-D-2*o)&nbsp;mod&nbsp;N;&nbsp;o:=-o;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line290"></a><div class='linenum'>290</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;if&nbsp;(1-D)/4&nbsp;mod&nbsp;N&nbsp;in&nbsp;[1,N-1]&nbsp;then&nbsp;return&nbsp;[5,5,5];&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line291"></a><div class='linenum'>291</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;return&nbsp;[D,1,(1-D)/4&nbsp;mod&nbsp;N];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line292"></a><div class='linenum'>292</div></td><td></td><td></td><td></td><td><span><tt>#end;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line293"></a><div class='linenum'>293</div></td><td></td><td></td><td></td><td><span><tt>#BPSWLucasParameters_BW1980_Bstar&nbsp;:=&nbsp;function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line294"></a><div class='linenum'>294</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;local&nbsp;D,P;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line295"></a><div class='linenum'>295</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;D:=5;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line296"></a><div class='linenum'>296</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;while&nbsp;Jacobi(D,N)&nbsp;&lt;>&nbsp;-1&nbsp;do&nbsp;D:=D+4;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line297"></a><div class='linenum'>297</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;P:=RootInt(D);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line298"></a><div class='linenum'>298</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;P:=P&nbsp;+&nbsp;((P+1)&nbsp;mod&nbsp;2);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line299"></a><div class='linenum'>299</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;while&nbsp;P^2&nbsp;&lt;&nbsp;D&nbsp;do&nbsp;P:=P+2;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line300"></a><div class='linenum'>300</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;if&nbsp;(P^2-D)/4&nbsp;mod&nbsp;N&nbsp;in&nbsp;[1,N-1]&nbsp;then&nbsp;return&nbsp;[D,(P+2)&nbsp;mod&nbsp;N,(P+(P^2-D)/4&nbsp;+&nbsp;1)&nbsp;mod&nbsp;N];&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line301"></a><div class='linenum'>301</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;return&nbsp;[D&nbsp;mod&nbsp;N,P&nbsp;mod&nbsp;N,(P^2-D)/4&nbsp;mod&nbsp;N];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line302"></a><div class='linenum'>302</div></td><td></td><td></td><td></td><td><span><tt>#end;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line303"></a><div class='linenum'>303</div></td><td></td><td></td><td></td><td><span><tt>#BPSWLucasParameters_WeiDei&nbsp;:=&nbsp;function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line304"></a><div class='linenum'>304</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;local&nbsp;D,k;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line305"></a><div class='linenum'>305</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;k:=1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line306"></a><div class='linenum'>306</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;while&nbsp;Jacobi((2*k+1)^2&nbsp;-&nbsp;4,N)&nbsp;=&nbsp;1&nbsp;do&nbsp;k:=k+1;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line307"></a><div class='linenum'>307</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;D:=(2*k+1)^2&nbsp;-&nbsp;4;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line308"></a><div class='linenum'>308</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;return&nbsp;[D,1,(1-D)/4];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line309"></a><div class='linenum'>309</div></td><td></td><td></td><td></td><td><span><tt>#end;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line310"></a><div class='linenum'>310</div></td><td></td><td></td><td></td><td><span><tt>#BPSWLucasParameters_GAP&nbsp;:=&nbsp;function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line311"></a><div class='linenum'>311</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;local&nbsp;P;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line312"></a><div class='linenum'>312</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;P:=2;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line313"></a><div class='linenum'>313</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;while&nbsp;Jacobi(&nbsp;P^2-4,&nbsp;N&nbsp;)&nbsp;&lt;>&nbsp;-1&nbsp;do&nbsp;P:=(P+1)&nbsp;mod&nbsp;N;&nbsp;if&nbsp;P&nbsp;=&nbsp;2&nbsp;then&nbsp;return&nbsp;fail;&nbsp;fi;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line314"></a><div class='linenum'>314</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;return&nbsp;[&nbsp;(P^2-4)&nbsp;mod&nbsp;N,&nbsp;P,&nbsp;1&nbsp;];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line315"></a><div class='linenum'>315</div></td><td></td><td></td><td></td><td><span><tt>#end;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line316"></a><div class='linenum'>316</div></td><td></td><td></td><td></td><td><span><tt>#InstallGlobalFunction(IsBPSWLucasPseudoPrime,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line317"></a><div class='linenum'>317</div></td><td></td><td></td><td></td><td><span><tt>#function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line318"></a><div class='linenum'>318</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;local&nbsp;params,&nbsp;func,&nbsp;lucas;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line319"></a><div class='linenum'>319</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;if&nbsp;N&nbsp;=&nbsp;2&nbsp;then&nbsp;return&nbsp;true;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line320"></a><div class='linenum'>320</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;if&nbsp;IsSquareInt(N)&nbsp;or&nbsp;IsEvenInt(N)&nbsp;then&nbsp;return&nbsp;false;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line321"></a><div class='linenum'>321</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;if&nbsp;ValueOption("BPSWLucasParameters")&nbsp;=&nbsp;fail&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line322"></a><div class='linenum'>322</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;then&nbsp;func:=BPSWLucasParameters_GAP;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line323"></a><div class='linenum'>323</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;else&nbsp;func:=ValueOption("BPSWLucasParameters");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line324"></a><div class='linenum'>324</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line325"></a><div class='linenum'>325</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;if&nbsp;ValueOption("BPSWLucasTest")&nbsp;=&nbsp;fail&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line326"></a><div class='linenum'>326</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;func&nbsp;=&nbsp;BPSWLucasParameters_GAP&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line327"></a><div class='linenum'>327</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;lucas:=function(N,D,P)&nbsp;return&nbsp;TraceModQF(P,N+1,N)&nbsp;=&nbsp;[2,P];&nbsp;end;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line328"></a><div class='linenum'>328</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;lucas:=IsLucasPseudoPrimeDP;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line329"></a><div class='linenum'>329</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line330"></a><div class='linenum'>330</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;else&nbsp;lucas:=ValueOption("BPSWLucasTest");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line331"></a><div class='linenum'>331</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line332"></a><div class='linenum'>332</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;params&nbsp;:=&nbsp;CALL_FUNC_LIST(func,[N]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line333"></a><div class='linenum'>333</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;if&nbsp;Jacobi(params[1],N)&nbsp;=&nbsp;0&nbsp;and&nbsp;params[1]&nbsp;&lt;&nbsp;N&nbsp;and&nbsp;0&nbsp;&lt;&nbsp;params[1]&nbsp;then&nbsp;return&nbsp;false;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line334"></a><div class='linenum'>334</div></td><td></td><td></td><td></td><td><span><tt>#&nbsp;&nbsp;return&nbsp;CALL_FUNC_LIST(lucas,[N,&nbsp;params[1],&nbsp;params[2]]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line335"></a><div class='linenum'>335</div></td><td></td><td></td><td></td><td><span><tt>#end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line336"></a><div class='linenum'>336</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line337"></a><div class='linenum'>337</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line338"></a><div class='linenum'>338</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line339"></a><div class='linenum'>339</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;IsLucasPseudoPrimeDP(N,D,P)&nbsp;-&nbsp;Check&nbsp;if&nbsp;N&nbsp;is&nbsp;a&nbsp;Lucas&nbsp;pseudoprime&nbsp;for&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line340"></a><div class='linenum'>340</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;x^2+P*x+(P^2-D)/4.&nbsp;D&nbsp;must&nbsp;be&nbsp;a&nbsp;nonsquare&nbsp;mod&nbsp;N,&nbsp;and&nbsp;N&nbsp;must&nbsp;be&nbsp;odd&nbsp;or&nbsp;prime.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line341"></a><div class='linenum'>341</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line342"></a><div class='linenum'>342</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line343"></a><div class='linenum'>343</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(IsLucasPseudoPrimeDP,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line344"></a><div class='linenum'>344</div></td><td></td><td></td><td></td><td><span><tt>function(N,D,P)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line345"></a><div class='linenum'>345</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;Q;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line346"></a><div class='linenum'>346</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;N&nbsp;=&nbsp;2&nbsp;then&nbsp;return&nbsp;true;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line347"></a><div class='linenum'>347</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;Q&nbsp;:=&nbsp;(P^2-D)/4&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line348"></a><div class='linenum'>348</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;not&nbsp;(&nbsp;IsOddInt(N)&nbsp;and&nbsp;0&nbsp;&lt;>&nbsp;Q&nbsp;mod&nbsp;N&nbsp;and&nbsp;Jacobi(D,N)&nbsp;=&nbsp;-1&nbsp;)&nbsp;then&nbsp;Error();&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line349"></a><div class='linenum'>349</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;IsOddInt(N)&nbsp;and&nbsp;0&nbsp;&lt;>&nbsp;Q&nbsp;mod&nbsp;N&nbsp;and&nbsp;Jacobi(D,N)&nbsp;=&nbsp;-1&nbsp;and&nbsp;0&nbsp;=&nbsp;LucasMod(P,Q,N,N+1)[1];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line350"></a><div class='linenum'>350</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line351"></a><div class='linenum'>351</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line352"></a><div class='linenum'>352</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line353"></a><div class='linenum'>353</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line354"></a><div class='linenum'>354</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;IsStrongLucasPseudoPrimeDP(N,D,P)&nbsp;-&nbsp;Check&nbsp;if&nbsp;N&nbsp;is&nbsp;a&nbsp;strong&nbsp;Lucas&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line355"></a><div class='linenum'>355</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;pseudoprime&nbsp;for&nbsp;x^2+P*x+(P^2-D)/4.&nbsp;N&nbsp;must&nbsp;be&nbsp;odd&nbsp;or&nbsp;prime.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line356"></a><div class='linenum'>356</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line357"></a><div class='linenum'>357</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line358"></a><div class='linenum'>358</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(IsStrongLucasPseudoPrimeDP,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line359"></a><div class='linenum'>359</div></td><td></td><td></td><td></td><td><span><tt>function(N,D,P)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line360"></a><div class='linenum'>360</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;Q,d,s,J,L,r,Qi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line361"></a><div class='linenum'>361</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;N&nbsp;=&nbsp;2&nbsp;then&nbsp;return&nbsp;true;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line362"></a><div class='linenum'>362</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;N&nbsp;in&nbsp;[-1,0,1]&nbsp;then&nbsp;return&nbsp;false;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line363"></a><div class='linenum'>363</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;not&nbsp;(&nbsp;IsOddInt(N)&nbsp;and&nbsp;GcdInt(N,D)=1&nbsp;)&nbsp;then&nbsp;return&nbsp;false;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line364"></a><div class='linenum'>364</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;Q&nbsp;:=&nbsp;(P^2-D)/4&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line365"></a><div class='linenum'>365</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;J&nbsp;:=&nbsp;Jacobi(D,N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line366"></a><div class='linenum'>366</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;d&nbsp;:=&nbsp;N&nbsp;-&nbsp;J;&nbsp;s:=0;&nbsp;while&nbsp;IsEvenInt(d)&nbsp;do&nbsp;s:=s+1;&nbsp;d:=d/2;&nbsp;od;&nbsp;#&nbsp;Now&nbsp;N-(D/N)&nbsp;=&nbsp;2^s&nbsp;*&nbsp;d,&nbsp;d&nbsp;odd
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line367"></a><div class='linenum'>367</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;L&nbsp;:=&nbsp;LucasMod(P,Q,N,d);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line368"></a><div class='linenum'>368</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Does&nbsp;n&nbsp;divide&nbsp;U_d&nbsp;?
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line369"></a><div class='linenum'>369</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;L[1]&nbsp;=&nbsp;0&nbsp;then&nbsp;return&nbsp;true;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line370"></a><div class='linenum'>370</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Does&nbsp;n&nbsp;divide&nbsp;V_{2^r&nbsp;d}&nbsp;for&nbsp;some&nbsp;r=0,1,...,s-1&nbsp;?
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line371"></a><div class='linenum'>371</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;Qi&nbsp;:=&nbsp;PowerModInt(Q,d,N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line372"></a><div class='linenum'>372</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;for&nbsp;r&nbsp;in&nbsp;[0..s-1]&nbsp;do
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line373"></a><div class='linenum'>373</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;L[2]&nbsp;=&nbsp;0&nbsp;then&nbsp;return&nbsp;true;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line374"></a><div class='linenum'>374</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;L&nbsp;is&nbsp;[Ui,Vi],&nbsp;make&nbsp;it&nbsp;[U2i,V2i]&nbsp;=&nbsp;[&nbsp;Ui*Vi,&nbsp;Vi^2&nbsp;-&nbsp;2Q^i],&nbsp;where&nbsp;i=2^s&nbsp;d
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line375"></a><div class='linenum'>375</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;L[1]&nbsp;:=&nbsp;L[1]*L[2]&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line376"></a><div class='linenum'>376</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;L[2]&nbsp;:=&nbsp;(L[2]^2&nbsp;-&nbsp;2*Qi)&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line377"></a><div class='linenum'>377</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;Qi&nbsp;&nbsp;&nbsp;:=&nbsp;Qi*Qi&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line378"></a><div class='linenum'>378</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line379"></a><div class='linenum'>379</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line380"></a><div class='linenum'>380</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line381"></a><div class='linenum'>381</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line382"></a><div class='linenum'>382</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line383"></a><div class='linenum'>383</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line384"></a><div class='linenum'>384</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;IsBSPWPseudoPrime(N)&nbsp;-&nbsp;Check&nbsp;if&nbsp;N&nbsp;is&nbsp;a&nbsp;Baillie-Pomerance-Selfridge-Wagstaff
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line385"></a><div class='linenum'>385</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;pseudoprime&nbsp;(that&nbsp;is,&nbsp;N&nbsp;is&nbsp;a&nbsp;possibly&nbsp;composite&nbsp;number&nbsp;with&nbsp;no&nbsp;proper
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line386"></a><div class='linenum'>386</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;divisors&nbsp;less&nbsp;than&nbsp;1000,&nbsp;N&nbsp;is&nbsp;a&nbsp;strong&nbsp;pseudoprime&nbsp;base&nbsp;2,&nbsp;and&nbsp;N&nbsp;is&nbsp;a
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line387"></a><div class='linenum'>387</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Lucas&nbsp;pseudoprime&nbsp;as&nbsp;above.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line388"></a><div class='linenum'>388</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line389"></a><div class='linenum'>389</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Note&nbsp;by&nbsp;http://www.chalcedon.demon.co.uk/rgep/spsp-13.gz&nbsp;we&nbsp;have&nbsp;that&nbsp;if
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line390"></a><div class='linenum'>390</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;N&nbsp;&lt;&nbsp;10^13&nbsp;is&nbsp;a&nbsp;BPSW-pp,&nbsp;then&nbsp;N&nbsp;is&nbsp;in&nbsp;fact&nbsp;prime.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line391"></a><div class='linenum'>391</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line392"></a><div class='linenum'>392</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line393"></a><div class='linenum'>393</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(IsBPSWPseudoPrime,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line394"></a><div class='linenum'>394</div></td><td></td><td></td><td></td><td><span><tt>function(n)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line395"></a><div class='linenum'>395</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Step&nbsp;1&nbsp;handle&nbsp;n&nbsp;with&nbsp;prime&nbsp;factors&nbsp;&lt;&nbsp;103
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line396"></a><div class='linenum'>396</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;1a:&nbsp;if&nbsp;n&nbsp;&lt;&nbsp;103,&nbsp;then&nbsp;n&nbsp;is&nbsp;prime&nbsp;exactly&nbsp;when&nbsp;it&nbsp;is&nbsp;listed
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line397"></a><div class='linenum'>397</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;1b:&nbsp;if&nbsp;n&nbsp;is&nbsp;even&nbsp;and&nbsp;>=103,&nbsp;then&nbsp;it&nbsp;is&nbsp;not&nbsp;prime
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line398"></a><div class='linenum'>398</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;1c-g:&nbsp;if&nbsp;n&nbsp;has&nbsp;a&nbsp;prime&nbsp;factor&nbsp;&lt;&nbsp;103,&nbsp;then&nbsp;it&nbsp;is&nbsp;not&nbsp;coprime
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line399"></a><div class='linenum'>399</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;to&nbsp;3*5*..*101&nbsp;split&nbsp;up&nbsp;into&nbsp;factors&nbsp;&lt;&nbsp;2^28.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line400"></a><div class='linenum'>400</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;1h:&nbsp;A&nbsp;composite&nbsp;number&nbsp;with&nbsp;no&nbsp;factors&nbsp;&lt;&nbsp;103&nbsp;must&nbsp;itself&nbsp;be&nbsp;>=&nbsp;103^2
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line401"></a><div class='linenum'>401</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;n&nbsp;:=&nbsp;AbsInt(n);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line402"></a><div class='linenum'>402</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;n&nbsp;&lt;&nbsp;1000&nbsp;then&nbsp;return&nbsp;n&nbsp;in&nbsp;Primes;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line403"></a><div class='linenum'>403</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;0&nbsp;=&nbsp;n&nbsp;mod&nbsp;2&nbsp;then&nbsp;return&nbsp;false;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line404"></a><div class='linenum'>404</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;1&lt;>GcdInt(n,257041785)&nbsp;then&nbsp;return&nbsp;false;&nbsp;#&nbsp;3*5*7*11*13*17*19*53
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line405"></a><div class='linenum'>405</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;1&lt;>GcdInt(n,&nbsp;11559991)&nbsp;then&nbsp;return&nbsp;false;&nbsp;#&nbsp;83*79*43*41
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line406"></a><div class='linenum'>406</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;1&lt;>GcdInt(n,259860509)&nbsp;then&nbsp;return&nbsp;false;&nbsp;#&nbsp;89*73*47*37*23
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line407"></a><div class='linenum'>407</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;1&lt;>GcdInt(n,&nbsp;12596323)&nbsp;then&nbsp;return&nbsp;false;&nbsp;#&nbsp;97*71*59*31
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line408"></a><div class='linenum'>408</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;1&lt;>GcdInt(n,&nbsp;11970823)&nbsp;then&nbsp;return&nbsp;false;&nbsp;#&nbsp;101*67*61*29
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line409"></a><div class='linenum'>409</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;n&nbsp;&lt;&nbsp;10609&nbsp;then&nbsp;return&nbsp;true;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line410"></a><div class='linenum'>410</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line411"></a><div class='linenum'>411</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line412"></a><div class='linenum'>412</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Step&nbsp;2&nbsp;handle&nbsp;n&nbsp;with&nbsp;prime&nbsp;factors&nbsp;&lt;&nbsp;1000
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line413"></a><div class='linenum'>413</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Note&nbsp;that&nbsp;if&nbsp;n&nbsp;&lt;&nbsp;1000&nbsp;we&nbsp;have&nbsp;already&nbsp;finished.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line414"></a><div class='linenum'>414</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;2a:&nbsp;Check&nbsp;Gcd(n,Product(Primes{[27..168]})&nbsp;=&nbsp;1&nbsp;if&nbsp;n&nbsp;&lt;&nbsp;2^100&nbsp;[worst&nbsp;case&nbsp;145&nbsp;divisions]
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line415"></a><div class='linenum'>415</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;2b:&nbsp;otherwise&nbsp;trial&nbsp;divide&nbsp;by&nbsp;the&nbsp;primes&nbsp;between&nbsp;103&nbsp;and&nbsp;997&nbsp;inclusive&nbsp;[142&nbsp;divisions]
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line416"></a><div class='linenum'>416</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;2c:&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;1009^2&nbsp;is&nbsp;composite,&nbsp;then&nbsp;it&nbsp;has&nbsp;a&nbsp;prime&nbsp;factor&nbsp;&lt;&nbsp;1009
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line417"></a><div class='linenum'>417</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;n&nbsp;&lt;&nbsp;2^100&nbsp;and&nbsp;1&lt;>GcdInt(n,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line418"></a><div class='linenum'>418</div></td><td></td><td></td><td></td><td><span><tt>841284107844892882230924743483896036230303226400884429367479745\
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line419"></a><div class='linenum'>419</div></td><td></td><td></td><td></td><td><span><tt>182396425076313801080105888842525657179186823477095844441732607\
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line420"></a><div class='linenum'>420</div></td><td></td><td></td><td></td><td><span><tt>309415612117497325122570590402649274666448191740488756513678929\
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line421"></a><div class='linenum'>421</div></td><td></td><td></td><td></td><td><span><tt>402959775310209214502833707784648441319210161128261125112776114\
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line422"></a><div class='linenum'>422</div></td><td></td><td></td><td></td><td><span><tt>119620471154579797706399078932717575475133487349361392344929340\
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line423"></a><div class='linenum'>423</div></td><td></td><td></td><td></td><td><span><tt>84356041841547537781640044258066541550710400764797315999285813)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line424"></a><div class='linenum'>424</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;then&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line425"></a><div class='linenum'>425</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;n&nbsp;>=&nbsp;2^100&nbsp;and&nbsp;ForAny(Primes,&nbsp;p&nbsp;->&nbsp;0&nbsp;=&nbsp;n&nbsp;mod&nbsp;p)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line426"></a><div class='linenum'>426</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;then&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line427"></a><div class='linenum'>427</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;n&nbsp;&lt;&nbsp;1018081&nbsp;then&nbsp;return&nbsp;true;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line428"></a><div class='linenum'>428</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line429"></a><div class='linenum'>429</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line430"></a><div class='linenum'>430</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Step&nbsp;3&nbsp;check&nbsp;if&nbsp;strong&nbsp;pseudo-prime&nbsp;base&nbsp;2
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line431"></a><div class='linenum'>431</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;3a:&nbsp;check&nbsp;for&nbsp;strong&nbsp;pseudo-prime&nbsp;base
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line432"></a><div class='linenum'>432</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;3b:&nbsp;the&nbsp;composite&nbsp;pseudo-primes&nbsp;base&nbsp;2&nbsp;less&nbsp;than&nbsp;10^7&nbsp;with&nbsp;no&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line433"></a><div class='linenum'>433</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;factors&nbsp;&lt;&nbsp;1000&nbsp;are&nbsp;listed&nbsp;in&nbsp;CompositeSPP2
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line434"></a><div class='linenum'>434</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;not&nbsp;IsStrongPseudoPrimeBaseA(n,2)&nbsp;then&nbsp;return&nbsp;false;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line435"></a><div class='linenum'>435</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;n&nbsp;&lt;&nbsp;10^7&nbsp;then&nbsp;return&nbsp;not&nbsp;n&nbsp;in&nbsp;CompositeSPP2;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line436"></a><div class='linenum'>436</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line437"></a><div class='linenum'>437</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line438"></a><div class='linenum'>438</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Step&nbsp;4&nbsp;Check&nbsp;for&nbsp;Lucas&nbsp;pseudo&nbsp;prime
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line439"></a><div class='linenum'>439</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;4a:&nbsp;Check&nbsp;if&nbsp;it&nbsp;is&nbsp;a&nbsp;Lucas&nbsp;pseudo&nbsp;prime
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line440"></a><div class='linenum'>440</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;4c:&nbsp;There&nbsp;are&nbsp;no&nbsp;composite&nbsp;&lt;&nbsp;10^13&nbsp;which&nbsp;are&nbsp;Lucas&nbsp;pseudo&nbsp;primes,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line441"></a><div class='linenum'>441</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;are&nbsp;strong&nbsp;pseudo&nbsp;primes&nbsp;base&nbsp;2
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line442"></a><div class='linenum'>442</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;See&nbsp;http://www.chalcedon.demon.co.uk/rgep/psp-12.gz
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line443"></a><div class='linenum'>443</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;and&nbsp;http://www.chalcedon.demon.co.uk/rgep/psp13.gz
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line444"></a><div class='linenum'>444</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;or&nbsp;&nbsp;http://www.chalcedon.demon.co.uk/rgep/spsp-13.gz
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line445"></a><div class='linenum'>445</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;This&nbsp;concludes&nbsp;the&nbsp;BPSW&nbsp;probablistic&nbsp;primality&nbsp;test.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line446"></a><div class='linenum'>446</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;not&nbsp;IsBPSWLucasPseudoPrime(n)&nbsp;then&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line447"></a><div class='linenum'>447</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;n&nbsp;&lt;&nbsp;10^13&nbsp;then&nbsp;return&nbsp;true;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line448"></a><div class='linenum'>448</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line449"></a><div class='linenum'>449</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line450"></a><div class='linenum'>450</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Step&nbsp;5&nbsp;Give&nbsp;up&nbsp;and&nbsp;call&nbsp;it&nbsp;a&nbsp;pseudoprime.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line451"></a><div class='linenum'>451</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;true;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line452"></a><div class='linenum'>452</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line453"></a><div class='linenum'>453</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line454"></a><div class='linenum'>454</div></td><td></td><td></td><td></td><td><span><tt>#############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line455"></a><div class='linenum'>455</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line456"></a><div class='linenum'>456</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;IsBPSWPseudoPrime_VerifyCorrectness()&nbsp;-&nbsp;Verify&nbsp;the&nbsp;BPSW&nbsp;correctly
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line457"></a><div class='linenum'>457</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;marks&nbsp;strong&nbsp;Fermat&nbsp;pseudoprimes&nbsp;base&nbsp;2&nbsp;as&nbsp;composite&nbsp;for&nbsp;N&nbsp;&lt;&nbsp;10^13.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line458"></a><div class='linenum'>458</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;not&nbsp;used&nbsp;in&nbsp;the&nbsp;code,&nbsp;but&nbsp;only&nbsp;there&nbsp;for&nbsp;testing
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line459"></a><div class='linenum'>459</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line460"></a><div class='linenum'>460</div></td><td></td><td></td><td></td><td><span><tt>#############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line461"></a><div class='linenum'>461</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(IsBPSWPseudoPrime_VerifyCorrectness,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line462"></a><div class='linenum'>462</div></td><td></td><td></td><td></td><td><span><tt>function()
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line463"></a><div class='linenum'>463</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;io,line;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line464"></a><div class='linenum'>464</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;io:=InputOutputLocalProcess(DirectoryCurrent(),&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line465"></a><div class='linenum'>465</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;Filename(DirectoriesSystemPrograms(),&nbsp;"lynx"),
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line466"></a><div class='linenum'>466</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;["-dump","http://www.chalcedon.demon.co.uk/rgep/spsp-13.gz"]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line467"></a><div class='linenum'>467</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;repeat&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line468"></a><div class='linenum'>468</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;:=&nbsp;ReadLine(io);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line469"></a><div class='linenum'>469</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;line=fail&nbsp;or&nbsp;line[Size(line)]&nbsp;&lt;>&nbsp;'\n'&nbsp;then&nbsp;Error("Bad&nbsp;line!");&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line470"></a><div class='linenum'>470</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;:=&nbsp;Int(Chomp(line));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line471"></a><div class='linenum'>471</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;IsBPSWPseudoPrime(line)&nbsp;&lt;>&nbsp;false&nbsp;then&nbsp;Error("Wrong&nbsp;output!");&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line472"></a><div class='linenum'>472</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;until&nbsp;line&nbsp;=&nbsp;9998974546471;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line473"></a><div class='linenum'>473</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;CloseStream(io);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line474"></a><div class='linenum'>474</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line475"></a><div class='linenum'>475</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line476"></a><div class='linenum'>476</div></td><td></td><td></td><td></td><td><span><tt>#############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line477"></a><div class='linenum'>477</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line478"></a><div class='linenum'>478</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Section&nbsp;3:&nbsp;Primality&nbsp;proof&nbsp;production,&nbsp;based&nbsp;on&nbsp;BLS&nbsp;1975
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line479"></a><div class='linenum'>479</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line480"></a><div class='linenum'>480</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(1)&nbsp;Find&nbsp;witnesses&nbsp;for&nbsp;each&nbsp;divisor&nbsp;(either&nbsp;Fermat&nbsp;or&nbsp;Lucas)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line481"></a><div class='linenum'>481</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(2)&nbsp;Suitable&nbsp;Factor&nbsp;N+-1&nbsp;to&nbsp;decide&nbsp;which&nbsp;witness&nbsp;are&nbsp;needed
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line482"></a><div class='linenum'>482</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(3)&nbsp;Main&nbsp;routine
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line483"></a><div class='linenum'>483</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(4)&nbsp;Simpler&nbsp;main&nbsp;routine&nbsp;which&nbsp;appears&nbsp;to&nbsp;be&nbsp;very&nbsp;adequate
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line484"></a><div class='linenum'>484</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line485"></a><div class='linenum'>485</div></td><td></td><td></td><td></td><td><span><tt>#############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line486"></a><div class='linenum'>486</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line487"></a><div class='linenum'>487</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Applicability:&nbsp;A&nbsp;number&nbsp;of&nbsp;results&nbsp;are&nbsp;used&nbsp;from&nbsp;BLS1975,&nbsp;but&nbsp;perhaps
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line488"></a><div class='linenum'>488</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Theorem&nbsp;21&nbsp;has&nbsp;the&nbsp;widest&nbsp;theoretical&nbsp;use.&nbsp;In&nbsp;short,&nbsp;if&nbsp;one&nbsp;factors
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line489"></a><div class='linenum'>489</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;the&nbsp;odd&nbsp;parts&nbsp;of&nbsp;N+-1&nbsp;into&nbsp;E,F&nbsp;(possibly&nbsp;composite)&nbsp;factors&nbsp;each&nbsp;of
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line490"></a><div class='linenum'>490</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;which&nbsp;has&nbsp;no&nbsp;prime&nbsp;divisors&nbsp;less&nbsp;than&nbsp;B&nbsp;and&nbsp;into&nbsp;various&nbsp;smaller&nbsp;prime
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line491"></a><div class='linenum'>491</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;factors,&nbsp;and&nbsp;if&nbsp;N&nbsp;&lt;&nbsp;B^(E+F+Max(E,F)),&nbsp;then&nbsp;Fermat&nbsp;and&nbsp;Lucas&nbsp;witnesses&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line492"></a><div class='linenum'>492</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;for&nbsp;those&nbsp;factors&nbsp;suffice&nbsp;to&nbsp;prove&nbsp;primality.&nbsp;In&nbsp;particular,&nbsp;if&nbsp;N&nbsp;&lt;&nbsp;B^3,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line493"></a><div class='linenum'>493</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;then&nbsp;we&nbsp;will&nbsp;succeed&nbsp;in&nbsp;our&nbsp;proof&nbsp;production.&nbsp;Currently&nbsp;GAP's&nbsp;FactorsInt
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line494"></a><div class='linenum'>494</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;gives&nbsp;us&nbsp;a&nbsp;value&nbsp;of&nbsp;B=10^6,&nbsp;and&nbsp;applicability&nbsp;for&nbsp;N&nbsp;&lt;&nbsp;10^18.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line495"></a><div class='linenum'>495</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line496"></a><div class='linenum'>496</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line497"></a><div class='linenum'>497</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line498"></a><div class='linenum'>498</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;PrimalityProof_FindFermat(N,P)&nbsp;-&nbsp;find&nbsp;a&nbsp;base&nbsp;A&nbsp;such&nbsp;that
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line499"></a><div class='linenum'>499</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;N&nbsp;is&nbsp;a&nbsp;strong&nbsp;Fermat&nbsp;pseudoprime&nbsp;base&nbsp;A&nbsp;and&nbsp;such&nbsp;that
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line500"></a><div class='linenum'>500</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;GcdInt(A^((N-1)/P)-1,N)=1.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line501"></a><div class='linenum'>501</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line502"></a><div class='linenum'>502</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Return&nbsp;[true,A]&nbsp;if&nbsp;such&nbsp;a&nbsp;base&nbsp;is&nbsp;found,&nbsp;or&nbsp;[false,B]&nbsp;if&nbsp;N
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line503"></a><div class='linenum'>503</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;has&nbsp;been&nbsp;proven&nbsp;composite&nbsp;(where&nbsp;B&nbsp;may&nbsp;help&nbsp;to&nbsp;verify&nbsp;this).
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line504"></a><div class='linenum'>504</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line505"></a><div class='linenum'>505</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line506"></a><div class='linenum'>506</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(PrimalityProof_FindFermat,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line507"></a><div class='linenum'>507</div></td><td></td><td></td><td></td><td><span><tt>function(N,p)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line508"></a><div class='linenum'>508</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;Np,a,b,c,g;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line509"></a><div class='linenum'>509</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;Np:=(N-1)/p;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line510"></a><div class='linenum'>510</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;a:=2;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line511"></a><div class='linenum'>511</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;while&nbsp;true&nbsp;do
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line512"></a><div class='linenum'>512</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;b:=PowerModInt(a,Np,N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line513"></a><div class='linenum'>513</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if(1&lt;>b)&nbsp;then&nbsp;break;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line514"></a><div class='linenum'>514</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;a:=a+1;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line515"></a><div class='linenum'>515</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if(a=N)&nbsp;then&nbsp;return&nbsp;[fail];&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line516"></a><div class='linenum'>516</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line517"></a><div class='linenum'>517</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;c:=PowerModInt(b,p,N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line518"></a><div class='linenum'>518</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if(1&nbsp;&lt;>&nbsp;c)&nbsp;then&nbsp;return&nbsp;[false,a];&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line519"></a><div class='linenum'>519</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;g:=GcdInt(b-1,N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line520"></a><div class='linenum'>520</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;1&nbsp;&lt;&nbsp;g&nbsp;and&nbsp;g&nbsp;&lt;&nbsp;N&nbsp;then&nbsp;return&nbsp;[false,g];&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line521"></a><div class='linenum'>521</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;[true,a];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line522"></a><div class='linenum'>522</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line523"></a><div class='linenum'>523</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line524"></a><div class='linenum'>524</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line525"></a><div class='linenum'>525</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line526"></a><div class='linenum'>526</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;PrimalityProof_FindLucas(N,D,K)&nbsp;-&nbsp;Find&nbsp;a&nbsp;polynomial
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line527"></a><div class='linenum'>527</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;x^2+P*x+Q&nbsp;with&nbsp;discriminant&nbsp;D=P^2-4Q&nbsp;such&nbsp;that&nbsp;the
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line528"></a><div class='linenum'>528</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;associated&nbsp;LucasSequence&nbsp;U&nbsp;satisfies&nbsp;U(N+1)&nbsp;=&nbsp;0&nbsp;mod&nbsp;N
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line529"></a><div class='linenum'>529</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;and&nbsp;Gcd(U((N+1)/K),N)=1.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line530"></a><div class='linenum'>530</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line531"></a><div class='linenum'>531</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Return&nbsp;[true,P]&nbsp;if&nbsp;such&nbsp;a&nbsp;polynomial&nbsp;is&nbsp;found,&nbsp;and
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line532"></a><div class='linenum'>532</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;[false,B]&nbsp;if&nbsp;N&nbsp;is&nbsp;shown&nbsp;to&nbsp;be&nbsp;composite&nbsp;(where&nbsp;B
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line533"></a><div class='linenum'>533</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;may&nbsp;help&nbsp;to&nbsp;verify&nbsp;this).
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line534"></a><div class='linenum'>534</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line535"></a><div class='linenum'>535</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line536"></a><div class='linenum'>536</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(PrimalityProof_FindLucas,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line537"></a><div class='linenum'>537</div></td><td></td><td></td><td></td><td><span><tt>function(N,D,K)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line538"></a><div class='linenum'>538</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;P,Q,g;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line539"></a><div class='linenum'>539</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;P:=2;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line540"></a><div class='linenum'>540</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;Q:=((P^2-D)/4)&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line541"></a><div class='linenum'>541</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;while&nbsp;true&nbsp;do
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line542"></a><div class='linenum'>542</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;0&nbsp;&lt;>&nbsp;LucasMod(P,Q,N,N+1)[1]&nbsp;then&nbsp;return&nbsp;[false,P,Q];&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line543"></a><div class='linenum'>543</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;g:=GcdInt(N,&nbsp;LucasMod(P,Q,N,(N+1)/K)[1]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line544"></a><div class='linenum'>544</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;1&lt;g&nbsp;and&nbsp;g&lt;N&nbsp;then&nbsp;return&nbsp;[false,g];&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line545"></a><div class='linenum'>545</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;1=g&nbsp;then&nbsp;return&nbsp;[true,P];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line546"></a><div class='linenum'>546</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line547"></a><div class='linenum'>547</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;Q:=(Q+P+1)&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line548"></a><div class='linenum'>548</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;P:=(P+2)&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line549"></a><div class='linenum'>549</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if(P=0)&nbsp;then&nbsp;return&nbsp;[fail];&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line550"></a><div class='linenum'>550</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line551"></a><div class='linenum'>551</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line552"></a><div class='linenum'>552</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line553"></a><div class='linenum'>553</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line554"></a><div class='linenum'>554</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line555"></a><div class='linenum'>555</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line556"></a><div class='linenum'>556</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;PrimalityProof_FindStructure(N)&nbsp;-&nbsp;Find&nbsp;divisors&nbsp;of&nbsp;N+-1&nbsp;which&nbsp;can&nbsp;be&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line557"></a><div class='linenum'>557</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;used&nbsp;to&nbsp;prove&nbsp;primality&nbsp;of&nbsp;N&nbsp;based&nbsp;on&nbsp;the&nbsp;ideas&nbsp;in&nbsp;BLS1975.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line558"></a><div class='linenum'>558</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line559"></a><div class='linenum'>559</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;pairs&nbsp;[T,div]&nbsp;where&nbsp;T&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;test
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line560"></a><div class='linenum'>560</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(either&nbsp;"F"&nbsp;or&nbsp;"L")&nbsp;and&nbsp;div&nbsp;is&nbsp;a&nbsp;divisor&nbsp;of&nbsp;N+-1.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line561"></a><div class='linenum'>561</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line562"></a><div class='linenum'>562</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;This&nbsp;routine&nbsp;requires&nbsp;a&nbsp;partial&nbsp;factorization&nbsp;routine.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line563"></a><div class='linenum'>563</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line564"></a><div class='linenum'>564</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line565"></a><div class='linenum'>565</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(PrimalityProof_FindStructure,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line566"></a><div class='linenum'>566</div></td><td></td><td></td><td></td><td><span><tt>function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line567"></a><div class='linenum'>567</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;cheap,&nbsp;FactIntPartial,&nbsp;factorsp,&nbsp;factorsm,&nbsp;sqrtN,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line568"></a><div class='linenum'>568</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;F1s,&nbsp;F1,&nbsp;R1,&nbsp;F2s,&nbsp;F2,&nbsp;R2,&nbsp;B,&nbsp;to_check,&nbsp;p,&nbsp;s,&nbsp;r;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line569"></a><div class='linenum'>569</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line570"></a><div class='linenum'>570</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;cheap:=ValueOption("cheap");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line571"></a><div class='linenum'>571</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;FactIntPartial:=ValueOption("FactIntPartial");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line572"></a><div class='linenum'>572</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if(cheap=fail)&nbsp;then&nbsp;cheap:=true;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line573"></a><div class='linenum'>573</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if(FactIntPartial=fail)&nbsp;then&nbsp;FactIntPartial:=true;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line574"></a><div class='linenum'>574</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line575"></a><div class='linenum'>575</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;try&nbsp;straightforward&nbsp;method&nbsp;first
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line576"></a><div class='linenum'>576</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;cheap=true&nbsp;and&nbsp;FactIntPartial=true&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line577"></a><div class='linenum'>577</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;to_check:=Concatenation(
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line578"></a><div class='linenum'>578</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List(Set(PartialFactorization(N-1,7)),p->["F",p]),
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line579"></a><div class='linenum'>579</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List(Set(PartialFactorization(N+1,7)),p->["L",p]));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line580"></a><div class='linenum'>580</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;[]&nbsp;&lt;>&nbsp;PrimalityProof_VerifyStructure(N,to_check)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line581"></a><div class='linenum'>581</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;return&nbsp;to_check;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line582"></a><div class='linenum'>582</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Info(InfoPrimeInt,1,"Straightforward&nbsp;Fermat-Lucas&nbsp;primality&nbsp;proof&nbsp;failed&nbsp;on&nbsp;",N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line583"></a><div class='linenum'>583</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line584"></a><div class='linenum'>584</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line585"></a><div class='linenum'>585</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line586"></a><div class='linenum'>586</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;sqrtN:=RootInt(N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line587"></a><div class='linenum'>587</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;B:=10^6;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line588"></a><div class='linenum'>588</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line589"></a><div class='linenum'>589</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;factorsm:=Factors(N-1&nbsp;:&nbsp;cheap:=cheap,&nbsp;FactIntPartial:=FactIntPartial);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line590"></a><div class='linenum'>590</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line591"></a><div class='linenum'>591</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;not&nbsp;IsList(factorsm[1])&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line592"></a><div class='linenum'>592</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;factorsm:=[factorsm,[1]];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line593"></a><div class='linenum'>593</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line594"></a><div class='linenum'>594</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;F1s:=Set(factorsm[1]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line595"></a><div class='linenum'>595</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;F1:=Product(factorsm[1]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line596"></a><div class='linenum'>596</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;R1:=Product(factorsm[2]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line597"></a><div class='linenum'>597</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line598"></a><div class='linenum'>598</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;BLS1975&nbsp;Cor1
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line599"></a><div class='linenum'>599</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;F1&nbsp;>&nbsp;sqrtN&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line600"></a><div class='linenum'>600</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;F1:=1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line601"></a><div class='linenum'>601</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;to_check:=[];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line602"></a><div class='linenum'>602</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;p&nbsp;in&nbsp;Reversed(F1s)&nbsp;do
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line603"></a><div class='linenum'>603</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddSet(to_check,p);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line604"></a><div class='linenum'>604</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F1:=F1*p^Number(factorsm[1],q->p=q);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line605"></a><div class='linenum'>605</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(F1&nbsp;>&nbsp;sqrtN)&nbsp;then&nbsp;break;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line606"></a><div class='linenum'>606</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line607"></a><div class='linenum'>607</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;List(to_check,p->["F",p]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line608"></a><div class='linenum'>608</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;BLS1975&nbsp;Cor3
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line609"></a><div class='linenum'>609</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;B*F1&nbsp;>&nbsp;sqrtN&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line610"></a><div class='linenum'>610</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;to_check:=F1s;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line611"></a><div class='linenum'>611</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;AddSet(to_check,R1);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line612"></a><div class='linenum'>612</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;List(to_check,p->["F",p]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line613"></a><div class='linenum'>613</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line614"></a><div class='linenum'>614</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;s:=QuoInt(R1,2*F1);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line615"></a><div class='linenum'>615</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;r:=2*F1*s-R1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line616"></a><div class='linenum'>616</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;BLS1975&nbsp;Th7
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line617"></a><div class='linenum'>617</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;N&nbsp;&lt;&nbsp;(B*F1+1)*(2*F1^2+(r-B)*F1+1)&nbsp;and&nbsp;(s=0&nbsp;or&nbsp;not&nbsp;IsSquareInt(r^2-8*s))&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line618"></a><div class='linenum'>618</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;to_check:=F1s;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line619"></a><div class='linenum'>619</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;AddSet(to_check,R1);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line620"></a><div class='linenum'>620</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;List(to_check,p->["F",p]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line621"></a><div class='linenum'>621</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line622"></a><div class='linenum'>622</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line623"></a><div class='linenum'>623</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;factorsp:=Factors(N+1&nbsp;:&nbsp;cheap:=cheap,&nbsp;FactIntPartial:=FactIntPartial);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line624"></a><div class='linenum'>624</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;not&nbsp;IsList(factorsp[1])&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line625"></a><div class='linenum'>625</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;factorsp:=[factorsp,[1]];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line626"></a><div class='linenum'>626</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line627"></a><div class='linenum'>627</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;F2s:=Set(factorsp[1]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line628"></a><div class='linenum'>628</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;F2:=Product(factorsp[1]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line629"></a><div class='linenum'>629</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;R2:=Product(factorsp[2]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line630"></a><div class='linenum'>630</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line631"></a><div class='linenum'>631</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;BLS1975&nbsp;Cor8
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line632"></a><div class='linenum'>632</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;F2&nbsp;>&nbsp;sqrtN&nbsp;+&nbsp;1&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line633"></a><div class='linenum'>633</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;F2:=1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line634"></a><div class='linenum'>634</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;to_check:=[];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line635"></a><div class='linenum'>635</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;p&nbsp;in&nbsp;Reversed(F2s)&nbsp;do
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line636"></a><div class='linenum'>636</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddSet(to_check,p);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line637"></a><div class='linenum'>637</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F2:=F2*p^Number(factorsp[1],q->p=q);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line638"></a><div class='linenum'>638</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;F2&nbsp;>&nbsp;sqrtN&nbsp;+&nbsp;1&nbsp;then&nbsp;break;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line639"></a><div class='linenum'>639</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line640"></a><div class='linenum'>640</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;List(to_check,p->["L",p]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line641"></a><div class='linenum'>641</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;BLS1975&nbsp;Cor3
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line642"></a><div class='linenum'>642</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;B*F2&nbsp;>&nbsp;sqrtN&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line643"></a><div class='linenum'>643</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;to_check:=F2s;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line644"></a><div class='linenum'>644</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;AddSet(to_check,R2);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line645"></a><div class='linenum'>645</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;List(to_check,p->["L",p]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line646"></a><div class='linenum'>646</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line647"></a><div class='linenum'>647</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;s:=BestQuoInt(R2,2*F2);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line648"></a><div class='linenum'>648</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;r:=R2-2*F2*s;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line649"></a><div class='linenum'>649</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;BLS1975&nbsp;Th19
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line650"></a><div class='linenum'>650</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;N&nbsp;&lt;&nbsp;(B*F2-1)*(2*F2^2&nbsp;+&nbsp;(B-AbsInt(r))*F2&nbsp;+&nbsp;1)&nbsp;and&nbsp;(s=0&nbsp;or&nbsp;not&nbsp;IsSquareInt(r^2+8*s))&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line651"></a><div class='linenum'>651</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;to_check:=F2s;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line652"></a><div class='linenum'>652</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;AddSet(to_check,R2);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line653"></a><div class='linenum'>653</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;List(to_check,p->["L",p]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line654"></a><div class='linenum'>654</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line655"></a><div class='linenum'>655</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line656"></a><div class='linenum'>656</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;BLS1975&nbsp;Cor11
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line657"></a><div class='linenum'>657</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;B^3*F1^2*F2&nbsp;>&nbsp;2*N&nbsp;or&nbsp;B^3*F1*F2^2&nbsp;>&nbsp;2*N&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line658"></a><div class='linenum'>658</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Union(List(F1s,p->["F",p]),List(F2s,p->["L",p]),[&nbsp;["F",R1],&nbsp;["L",R2]]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line659"></a><div class='linenum'>659</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line660"></a><div class='linenum'>660</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line661"></a><div class='linenum'>661</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;cheap&nbsp;=&nbsp;true&nbsp;then&nbsp;return&nbsp;PrimalityProof_FindStructure(N:cheap:=false);&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line662"></a><div class='linenum'>662</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line663"></a><div class='linenum'>663</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;fail;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line664"></a><div class='linenum'>664</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line665"></a><div class='linenum'>665</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line666"></a><div class='linenum'>666</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line667"></a><div class='linenum'>667</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line668"></a><div class='linenum'>668</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;PrimalityProof(N)&nbsp;-&nbsp;Construct&nbsp;a&nbsp;machine&nbsp;verifiable&nbsp;proof&nbsp;of&nbsp;the&nbsp;primality
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line669"></a><div class='linenum'>669</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;of&nbsp;(the&nbsp;probable&nbsp;prime)&nbsp;N,&nbsp;following&nbsp;the&nbsp;ideas&nbsp;of&nbsp;the&nbsp;paper&nbsp;Brillhart,&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line670"></a><div class='linenum'>670</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Lehmer,&nbsp;Selfridge's&nbsp;"New&nbsp;Primality&nbsp;Criteria&nbsp;and&nbsp;Factorizations&nbsp;of&nbsp;2^m&nbsp;+-1",&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line671"></a><div class='linenum'>671</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;1975.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line672"></a><div class='linenum'>672</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line673"></a><div class='linenum'>673</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line674"></a><div class='linenum'>674</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(PrimalityProof,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line675"></a><div class='linenum'>675</div></td><td></td><td></td><td></td><td><span><tt>function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line676"></a><div class='linenum'>676</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;factors,certs,D,J,p,ret;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line677"></a><div class='linenum'>677</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line678"></a><div class='linenum'>678</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if(N&lt;=2)&nbsp;then&nbsp;return&nbsp;fail;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line679"></a><div class='linenum'>679</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;0&nbsp;=&nbsp;N&nbsp;mod&nbsp;2&nbsp;then&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line680"></a><div class='linenum'>680</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line681"></a><div class='linenum'>681</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line682"></a><div class='linenum'>682</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;factors:=PrimalityProof_FindStructure(N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line683"></a><div class='linenum'>683</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if(factors=fail)&nbsp;then&nbsp;return&nbsp;fail;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line684"></a><div class='linenum'>684</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line685"></a><div class='linenum'>685</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if(ForAny(factors,p->p[1]="L"))&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line686"></a><div class='linenum'>686</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;D:=1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line687"></a><div class='linenum'>687</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;repeat&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line688"></a><div class='linenum'>688</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D:=(D+1)&nbsp;mod&nbsp;N;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line689"></a><div class='linenum'>689</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(D=0)&nbsp;then&nbsp;Error();&nbsp;return&nbsp;fail;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line690"></a><div class='linenum'>690</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;J:=Jacobi(D,N);&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line691"></a><div class='linenum'>691</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(J=0)&nbsp;then&nbsp;Error();&nbsp;return&nbsp;false;&nbsp;fi;&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line692"></a><div class='linenum'>692</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;until&nbsp;J=-1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line693"></a><div class='linenum'>693</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line694"></a><div class='linenum'>694</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;certs:=[];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line695"></a><div class='linenum'>695</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;for&nbsp;p&nbsp;in&nbsp;factors&nbsp;do
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line696"></a><div class='linenum'>696</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;p[1]="F"&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line697"></a><div class='linenum'>697</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret:=PrimalityProof_FindFermat(N,p[2]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line698"></a><div class='linenum'>698</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(ret[1]=fail)&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line699"></a><div class='linenum'>699</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Print("\n\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line700"></a><div class='linenum'>700</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Print("#&nbsp;!!!&nbsp;Please&nbsp;email&nbsp;support@gap-system.org&nbsp;the&nbsp;following:\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line701"></a><div class='linenum'>701</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Print("#&nbsp;!!!&nbsp;PrimalityProof(",HexStringInt(N),")&nbsp;failed&nbsp;at&nbsp;F",p[2],"\n\n\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line702"></a><div class='linenum'>702</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error("#&nbsp;!!!&nbsp;You&nbsp;have&nbsp;probably&nbsp;found&nbsp;a&nbsp;bug.&nbsp;Theoretically&nbsp;&lt;n>&nbsp;is&nbsp;composite.");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line703"></a><div class='linenum'>703</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fail;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line704"></a><div class='linenum'>704</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif(ret[1]=false)&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line705"></a><div class='linenum'>705</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;0&nbsp;=&nbsp;N&nbsp;mod&nbsp;ret[2]&nbsp;and&nbsp;1&lt;ret[2]&nbsp;and&nbsp;ret[2]&lt;N
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line706"></a><div class='linenum'>706</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;Error("#&nbsp;PrimalityProof:&nbsp;",N,"&nbsp;is&nbsp;composite&nbsp;(divisible&nbsp;by&nbsp;",ret[2],").");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line707"></a><div class='linenum'>707</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;0&nbsp;&lt;>&nbsp;ret[2]&nbsp;mod&nbsp;N&nbsp;and&nbsp;1&nbsp;&lt;>&nbsp;PowerModInt(ret[2],N-1,N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line708"></a><div class='linenum'>708</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;Error("#&nbsp;PrimalityProof:&nbsp;",N,"&nbsp;is&nbsp;composite&nbsp;(",ret[2],"^",N-1,"&nbsp;mod&nbsp;N&nbsp;is&nbsp;not&nbsp;1).");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line709"></a><div class='linenum'>709</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Error("#&nbsp;PrimalityProof:&nbsp;unknown&nbsp;error.&nbsp;N&nbsp;is&nbsp;supposedly&nbsp;composite.");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line710"></a><div class='linenum'>710</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line711"></a><div class='linenum'>711</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line712"></a><div class='linenum'>712</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif(ret[1]=true)&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line713"></a><div class='linenum'>713</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add(certs,["F",p[2],ret[2]]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line714"></a><div class='linenum'>714</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line715"></a><div class='linenum'>715</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;p[1]="L"&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line716"></a><div class='linenum'>716</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret:=PrimalityProof_FindLucas(N,D,p[2]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line717"></a><div class='linenum'>717</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(ret[1]=fail)&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line718"></a><div class='linenum'>718</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Print("\n\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line719"></a><div class='linenum'>719</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Print("#&nbsp;!!!&nbsp;Please&nbsp;email&nbsp;support@gap-system.org&nbsp;the&nbsp;following:\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line720"></a><div class='linenum'>720</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Print("#&nbsp;!!!&nbsp;PrimalityProof(",HexStringInt(N),")&nbsp;failed&nbsp;at&nbsp;L",p[2],"\n\n\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line721"></a><div class='linenum'>721</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error("#&nbsp;!!!&nbsp;You&nbsp;have&nbsp;probably&nbsp;found&nbsp;a&nbsp;bug.&nbsp;Theoretically&nbsp;&lt;n>&nbsp;is&nbsp;composite.");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line722"></a><div class='linenum'>722</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fail;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line723"></a><div class='linenum'>723</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif(ret[1]=false)&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line724"></a><div class='linenum'>724</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;0&nbsp;=&nbsp;N&nbsp;mod&nbsp;ret[2]&nbsp;and&nbsp;1&lt;ret[2]&nbsp;and&nbsp;ret[2]&lt;N
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line725"></a><div class='linenum'>725</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;Error("#&nbsp;PrimalityProof:&nbsp;",N,"&nbsp;is&nbsp;composite&nbsp;(divisible&nbsp;by&nbsp;",ret[2],").");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line726"></a><div class='linenum'>726</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;0&nbsp;&lt;>&nbsp;LucasMod(ret[2],ret[3],N,N-1)[1]&nbsp;mod&nbsp;N&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line727"></a><div class='linenum'>727</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;Error("#&nbsp;PrimalityProof:&nbsp;",N,"&nbsp;is&nbsp;composite&nbsp;(Lucas(",ret[2],",",ret[3],",N-1)&nbsp;mod&nbsp;N&nbsp;is&nbsp;not&nbsp;0).");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line728"></a><div class='linenum'>728</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Error("#&nbsp;PrimalityProof:&nbsp;unknown&nbsp;error.&nbsp;N&nbsp;is&nbsp;supposedly&nbsp;composite.");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line729"></a><div class='linenum'>729</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line730"></a><div class='linenum'>730</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line731"></a><div class='linenum'>731</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif(ret[1]=true)&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line732"></a><div class='linenum'>732</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add(certs,["L",p[2],D,ret[2]]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line733"></a><div class='linenum'>733</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line734"></a><div class='linenum'>734</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;else
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line735"></a><div class='linenum'>735</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error("Unknown&nbsp;certification&nbsp;requested.");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line736"></a><div class='linenum'>736</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fail;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line737"></a><div class='linenum'>737</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line738"></a><div class='linenum'>738</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line739"></a><div class='linenum'>739</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;certs;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line740"></a><div class='linenum'>740</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line741"></a><div class='linenum'>741</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line742"></a><div class='linenum'>742</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line743"></a><div class='linenum'>743</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line744"></a><div class='linenum'>744</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line745"></a><div class='linenum'>745</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Section&nbsp;4:&nbsp;Primality&nbsp;proof&nbsp;verification
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line746"></a><div class='linenum'>746</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line747"></a><div class='linenum'>747</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(1)&nbsp;Verify&nbsp;witnesses
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line748"></a><div class='linenum'>748</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(2)&nbsp;Verify&nbsp;the&nbsp;collection&nbsp;of&nbsp;witnesses&nbsp;would&nbsp;provide&nbsp;a&nbsp;primality&nbsp;proof
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line749"></a><div class='linenum'>749</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(3)&nbsp;Main&nbsp;interface
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line750"></a><div class='linenum'>750</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line751"></a><div class='linenum'>751</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line752"></a><div class='linenum'>752</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line753"></a><div class='linenum'>753</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line754"></a><div class='linenum'>754</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line755"></a><div class='linenum'>755</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;PrimalityProof_VerifyWitness(N,witness)&nbsp;-&nbsp;ensure&nbsp;that&nbsp;the&nbsp;proposed
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line756"></a><div class='linenum'>756</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;witness&nbsp;is&nbsp;valid.&nbsp;In&nbsp;other&nbsp;words&nbsp;check&nbsp;condition&nbsp;II&nbsp;or&nbsp;IV&nbsp;from&nbsp;BLS1975.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line757"></a><div class='linenum'>757</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line758"></a><div class='linenum'>758</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line759"></a><div class='linenum'>759</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(PrimalityProof_VerifyWitness,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line760"></a><div class='linenum'>760</div></td><td></td><td></td><td></td><td><span><tt>function(N,witness)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line761"></a><div class='linenum'>761</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;type,&nbsp;divisor,&nbsp;base,&nbsp;D,&nbsp;P,&nbsp;Q;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line762"></a><div class='linenum'>762</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line763"></a><div class='linenum'>763</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;type:=witness[1];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line764"></a><div class='linenum'>764</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if(&nbsp;type&nbsp;=&nbsp;"F"&nbsp;)&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line765"></a><div class='linenum'>765</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;divisor&nbsp;:=&nbsp;witness[2];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line766"></a><div class='linenum'>766</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;base&nbsp;:=&nbsp;witness[3];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line767"></a><div class='linenum'>767</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;IsStrongPseudoPrimeBaseA(N,base)&nbsp;and&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line768"></a><div class='linenum'>768</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GcdInt(&nbsp;PowerModInt(base,(N-1)/divisor,N)-1,&nbsp;N)&nbsp;=&nbsp;1;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line769"></a><div class='linenum'>769</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif(&nbsp;type&nbsp;=&nbsp;"L"&nbsp;)&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line770"></a><div class='linenum'>770</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;divisor&nbsp;:=&nbsp;witness[2];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line771"></a><div class='linenum'>771</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;D&nbsp;:=&nbsp;witness[3];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line772"></a><div class='linenum'>772</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;:=&nbsp;witness[4];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line773"></a><div class='linenum'>773</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;Q&nbsp;:=&nbsp;(P^2-D)/4&nbsp;mod&nbsp;N;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line774"></a><div class='linenum'>774</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Jacobi(D,N)=-1&nbsp;and&nbsp;0&nbsp;=&nbsp;LucasMod(P,Q,N,N+1)[1]
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line775"></a><div class='linenum'>775</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;1&nbsp;=&nbsp;GcdInt(N,&nbsp;LucasMod(P,Q,N,(N+1)/divisor)[1]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line776"></a><div class='linenum'>776</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line777"></a><div class='linenum'>777</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;fail;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line778"></a><div class='linenum'>778</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line779"></a><div class='linenum'>779</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line780"></a><div class='linenum'>780</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line781"></a><div class='linenum'>781</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line782"></a><div class='linenum'>782</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line783"></a><div class='linenum'>783</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;PrimalityProof_VerifyStructure(N,witnesses)&nbsp;-&nbsp;Verify&nbsp;that&nbsp;the&nbsp;collection
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line784"></a><div class='linenum'>784</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;of&nbsp;witness&nbsp;actually&nbsp;satisfies&nbsp;the&nbsp;hypotheses&nbsp;of&nbsp;one&nbsp;of&nbsp;the&nbsp;results&nbsp;in
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line785"></a><div class='linenum'>785</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;BLS1975.&nbsp;Failure&nbsp;is&nbsp;indicated&nbsp;by&nbsp;an&nbsp;empty&nbsp;list.&nbsp;Success&nbsp;is&nbsp;a&nbsp;list:
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line786"></a><div class='linenum'>786</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;[true,&nbsp;NameOfTheorem,&nbsp;AssumedPrimes,&nbsp;DivisorBound,&nbsp;SortOfPrimes&nbsp;]
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line787"></a><div class='linenum'>787</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line788"></a><div class='linenum'>788</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;In&nbsp;this&nbsp;case,&nbsp;the&nbsp;routine&nbsp;recognized&nbsp;the&nbsp;proof&nbsp;but&nbsp;may&nbsp;require
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line789"></a><div class='linenum'>789</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;some&nbsp;lemmas.&nbsp;Every&nbsp;number&nbsp;in&nbsp;AssumedPrimes&nbsp;must&nbsp;be&nbsp;proven&nbsp;prime.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line790"></a><div class='linenum'>790</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Every&nbsp;number&nbsp;in&nbsp;SortOfPrimes&nbsp;must&nbsp;either&nbsp;be&nbsp;(prime&nbsp;and&nbsp;less&nbsp;than
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line791"></a><div class='linenum'>791</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;DivisorBound)&nbsp;or&nbsp;relatively&nbsp;prime&nbsp;to&nbsp;Factorial(DivisorBound).
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line792"></a><div class='linenum'>792</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;DivisorBound&nbsp;is&nbsp;always&nbsp;small&nbsp;enough&nbsp;to&nbsp;make&nbsp;this&nbsp;check&nbsp;feasible
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line793"></a><div class='linenum'>793</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(currently&nbsp;capped&nbsp;at&nbsp;10^6).
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line794"></a><div class='linenum'>794</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line795"></a><div class='linenum'>795</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line796"></a><div class='linenum'>796</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(PrimalityProof_VerifyStructure,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line797"></a><div class='linenum'>797</div></td><td></td><td></td><td></td><td><span><tt>function(N,witnesses)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line798"></a><div class='linenum'>798</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;Fs,Ls,F,L,B,BF,BL,&nbsp;MaxB,&nbsp;B1,&nbsp;B2,&nbsp;F1s,&nbsp;F2s,&nbsp;R1s,&nbsp;R2s,&nbsp;F1,&nbsp;F2,&nbsp;R1,&nbsp;R2,&nbsp;r,&nbsp;s,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line799"></a><div class='linenum'>799</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;QuadraticEstimate,&nbsp;GotOne,&nbsp;rets;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line800"></a><div class='linenum'>800</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;MaxB:=10^6;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line801"></a><div class='linenum'>801</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line802"></a><div class='linenum'>802</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;QuadraticEstimate:=function(a,b,c)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line803"></a><div class='linenum'>803</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;b^2&nbsp;-&nbsp;4*a*c&nbsp;&lt;&nbsp;0&nbsp;then&nbsp;return&nbsp;10^100;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line804"></a><div class='linenum'>804</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Int((-b&nbsp;+&nbsp;RootInt(b^2-4*a*c))/(2*a));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line805"></a><div class='linenum'>805</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;end;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line806"></a><div class='linenum'>806</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line807"></a><div class='linenum'>807</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;GotOne:=function(ret)&nbsp;Add(rets,ret);&nbsp;end;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line808"></a><div class='linenum'>808</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;rets:=[];
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line809"></a><div class='linenum'>809</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line810"></a><div class='linenum'>810</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;Fs:=List(Filtered(witnesses,wit->wit[1]="F"),wit->wit[2]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line811"></a><div class='linenum'>811</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;Ls:=List(Filtered(witnesses,wit->wit[1]="L"),wit->wit[2]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line812"></a><div class='linenum'>812</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line813"></a><div class='linenum'>813</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Every&nbsp;number&nbsp;in&nbsp;F1s&nbsp;and&nbsp;F2s&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;prime
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line814"></a><div class='linenum'>814</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;F1s:=Filtered(Fs,p->p&lt;10^13&nbsp;and&nbsp;IsBPSWPseudoPrime(p));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line815"></a><div class='linenum'>815</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;R1s:=Filtered(Fs,p->p>10^13&nbsp;or&nbsp;not&nbsp;IsBPSWPseudoPrime(p));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line816"></a><div class='linenum'>816</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;F2s:=Filtered(Ls,p->p&lt;10^13&nbsp;and&nbsp;IsBPSWPseudoPrime(p));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line817"></a><div class='linenum'>817</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;R2s:=Filtered(Ls,p->p>10^13&nbsp;or&nbsp;not&nbsp;IsBPSWPseudoPrime(p));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line818"></a><div class='linenum'>818</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line819"></a><div class='linenum'>819</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;F1:=Product(F1s,&nbsp;p->p^Valuation(N-1,p));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line820"></a><div class='linenum'>820</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;R1:=Product(R1s,&nbsp;p->p^Valuation(N-1,p));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line821"></a><div class='linenum'>821</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;F2:=Product(F2s,&nbsp;p->p^Valuation(N+1,p));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line822"></a><div class='linenum'>822</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;R2:=Product(R2s,&nbsp;p->p^Valuation(N+1,p));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line823"></a><div class='linenum'>823</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line824"></a><div class='linenum'>824</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Check&nbsp;Co1
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line825"></a><div class='linenum'>825</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;F1^2&nbsp;>&nbsp;N&nbsp;then&nbsp;GotOne([&nbsp;true,&nbsp;"BLS1975-Co1",&nbsp;[]&nbsp;,&nbsp;1&nbsp;,&nbsp;[]&nbsp;]);&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line826"></a><div class='linenum'>826</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line827"></a><div class='linenum'>827</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Check&nbsp;Cor3&nbsp;and&nbsp;Th7
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line828"></a><div class='linenum'>828</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;Size(R1s)=1&nbsp;and&nbsp;R1s[1]=R1&nbsp;and&nbsp;F1*R1=N-1&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line829"></a><div class='linenum'>829</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line830"></a><div class='linenum'>830</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;Cor3,&nbsp;solving&nbsp;for&nbsp;B1
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line831"></a><div class='linenum'>831</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;B1&nbsp;:=&nbsp;RootInt(&nbsp;Int(N/F1^2)&nbsp;);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line832"></a><div class='linenum'>832</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;B1&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;N&nbsp;>=&nbsp;(B1*F1)^2&nbsp;do&nbsp;B1:=B1+1;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line833"></a><div class='linenum'>833</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line834"></a><div class='linenum'>834</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;B1&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;N&nbsp;&lt;&nbsp;(B1*F1)^2
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line835"></a><div class='linenum'>835</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;GotOne([&nbsp;true,&nbsp;"BLS1975-Co3",&nbsp;[],&nbsp;B1,&nbsp;R1s]);&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line836"></a><div class='linenum'>836</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line837"></a><div class='linenum'>837</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line838"></a><div class='linenum'>838</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;Th7,&nbsp;solving&nbsp;for&nbsp;B1
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line839"></a><div class='linenum'>839</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;s:=QuoInt(R1,2*F1);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line840"></a><div class='linenum'>840</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;r:=R1-2*F1*s;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line841"></a><div class='linenum'>841</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Want&nbsp;B1&nbsp;large&nbsp;so&nbsp;that&nbsp;N>=&nbsp;(B1*F1+1)*(2*F1^2+(r-B1)*F1+1)&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line842"></a><div class='linenum'>842</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;B1&nbsp;:=&nbsp;QuadraticEstimate(&nbsp;-F1^2,&nbsp;2*F1^3&nbsp;+&nbsp;r*F1^2,&nbsp;2*F1^2+r*F1+1-N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line843"></a><div class='linenum'>843</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#B1&nbsp;:=&nbsp;Int(N/(F1+1)/(2*F1^2+r*F1+1));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line844"></a><div class='linenum'>844</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;B1&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;2*F1^2+(r-B1)*F1+1&nbsp;>&nbsp;0&nbsp;and&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line845"></a><div class='linenum'>845</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N&nbsp;>=&nbsp;(B1*F1+1)*(2*F1^2+(r-B1)*F1+1)&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line846"></a><div class='linenum'>846</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;B1:=B1+1;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line847"></a><div class='linenum'>847</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line848"></a><div class='linenum'>848</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;B1&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;N&nbsp;&lt;&nbsp;(B1*F1+1)*(2*F1^2+(r-B1)*F1+1)&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line849"></a><div class='linenum'>849</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;GotOne([&nbsp;0=s&nbsp;or&nbsp;not&nbsp;IsSquareInt(r^2-8*s),&nbsp;"BLS1975-Th7",&nbsp;[],&nbsp;B1,&nbsp;R1s&nbsp;]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line850"></a><div class='linenum'>850</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line851"></a><div class='linenum'>851</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line852"></a><div class='linenum'>852</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line853"></a><div class='linenum'>853</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Check&nbsp;Cor8
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line854"></a><div class='linenum'>854</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;(F2-1)^2&nbsp;>&nbsp;N&nbsp;then&nbsp;GotOne([&nbsp;true,&nbsp;"BLS1975-Co8",&nbsp;[],&nbsp;1&nbsp;,&nbsp;[]&nbsp;]);&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line855"></a><div class='linenum'>855</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line856"></a><div class='linenum'>856</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Check&nbsp;Cor10&nbsp;and&nbsp;Th19
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line857"></a><div class='linenum'>857</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;Size(R2s)=1&nbsp;and&nbsp;R2s[1]=R2&nbsp;and&nbsp;F2*R2=N+1&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line858"></a><div class='linenum'>858</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line859"></a><div class='linenum'>859</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;Cor10
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line860"></a><div class='linenum'>860</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Want&nbsp;large&nbsp;B2&nbsp;such&nbsp;that&nbsp;(B2*F2-1)^2&nbsp;&lt;=&nbsp;N
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line861"></a><div class='linenum'>861</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;B2&nbsp;:=&nbsp;RootInt(Int(N/F2^2));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line862"></a><div class='linenum'>862</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;B2&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;(B2*F2-1)^2&nbsp;&lt;=&nbsp;N&nbsp;do&nbsp;B2:=B2+1;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line863"></a><div class='linenum'>863</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line864"></a><div class='linenum'>864</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;B2&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;N&nbsp;&lt;&nbsp;(B2*F2-1)^2
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line865"></a><div class='linenum'>865</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;GotOne([&nbsp;true,&nbsp;"BLS1975-Co10",&nbsp;[],&nbsp;B2,&nbsp;R2s&nbsp;]);&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line866"></a><div class='linenum'>866</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line867"></a><div class='linenum'>867</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line868"></a><div class='linenum'>868</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;Th19
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line869"></a><div class='linenum'>869</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;s:=BestQuoInt(R2,2*F2);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line870"></a><div class='linenum'>870</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;r:=R2-2*F2;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line871"></a><div class='linenum'>871</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Want&nbsp;large&nbsp;B2&nbsp;such&nbsp;that&nbsp;(B2*F2-1)*(2*F2^2&nbsp;+&nbsp;(B2-|r|)*F2&nbsp;+1)&nbsp;&lt;=&nbsp;N
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line872"></a><div class='linenum'>872</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;B2:=QuadraticEstimate(F2^2,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line873"></a><div class='linenum'>873</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*F2^3-F2^2*AbsInt(r),&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line874"></a><div class='linenum'>874</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F2*AbsInt(r)&nbsp;-&nbsp;2*F2^2&nbsp;-&nbsp;1&nbsp;-&nbsp;N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line875"></a><div class='linenum'>875</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;B2&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;(B2*F2-1)*(2*F2^2&nbsp;+&nbsp;(B2-AbsInt(r))*F2&nbsp;+1)&nbsp;&lt;=&nbsp;N&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line876"></a><div class='linenum'>876</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;B2:=B2+1;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line877"></a><div class='linenum'>877</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line878"></a><div class='linenum'>878</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;B2&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;N&nbsp;&lt;&nbsp;(B2*F2-1)*(2*F2^2&nbsp;+&nbsp;(B2-AbsInt(r))*F2&nbsp;+1)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line879"></a><div class='linenum'>879</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;GotOne([&nbsp;s=0&nbsp;or&nbsp;not&nbsp;IsSquareInt(r^2+8*s),&nbsp;"BLS1975-Th19",&nbsp;[],&nbsp;B2,&nbsp;R2s&nbsp;]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line880"></a><div class='linenum'>880</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line881"></a><div class='linenum'>881</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line882"></a><div class='linenum'>882</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line883"></a><div class='linenum'>883</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Check&nbsp;Cor11
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line884"></a><div class='linenum'>884</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;(&nbsp;R1=1&nbsp;or&nbsp;(Size(R1s)=1&nbsp;and&nbsp;R1s[1]=R1))
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line885"></a><div class='linenum'>885</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;(&nbsp;R2=1&nbsp;or&nbsp;(Size(R2s)=1&nbsp;and&nbsp;R2s[1]=R2))
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line886"></a><div class='linenum'>886</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line887"></a><div class='linenum'>887</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;B2&nbsp;:=&nbsp;RootInt(&nbsp;Int(N/F1/F2/Maximum(F1,F2)),&nbsp;3);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line888"></a><div class='linenum'>888</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;B2&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;B2^3&nbsp;&lt;=&nbsp;N/F1/F2/Maximum(F1,F2)&nbsp;do&nbsp;B2:=B2+1;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line889"></a><div class='linenum'>889</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line890"></a><div class='linenum'>890</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;B2&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;B2^3&nbsp;>&nbsp;2*N/F1/F2/Maximum(F1,F2)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line891"></a><div class='linenum'>891</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;GotOne([true,&nbsp;"BLS1975-Co11",&nbsp;[],&nbsp;B2,&nbsp;Set(Concatenation(R1s,R2s))]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line892"></a><div class='linenum'>892</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line893"></a><div class='linenum'>893</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line894"></a><div class='linenum'>894</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line895"></a><div class='linenum'>895</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;First&nbsp;check&nbsp;Theorem&nbsp;21,&nbsp;which&nbsp;requires&nbsp;no&nbsp;primality&nbsp;assumptions
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line896"></a><div class='linenum'>896</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;on&nbsp;the&nbsp;divisors&nbsp;(only&nbsp;a&nbsp;bound&nbsp;the&nbsp;proper&nbsp;prime&nbsp;factors&nbsp;of&nbsp;those
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line897"></a><div class='linenum'>897</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;divisors).
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line898"></a><div class='linenum'>898</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;F1*R1&nbsp;=&nbsp;N-1&nbsp;and&nbsp;F2*R2&nbsp;=&nbsp;N+1&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line899"></a><div class='linenum'>899</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line900"></a><div class='linenum'>900</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;BF&nbsp;:=&nbsp;Sum(Fs,p->Valuation(N-1,p));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line901"></a><div class='linenum'>901</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;BL&nbsp;:=&nbsp;Sum(Ls,p->Valuation(N+1,p));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line902"></a><div class='linenum'>902</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;B1&nbsp;:=&nbsp;RootInt(N,BF+BL+Maximum(BF,BL));&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line903"></a><div class='linenum'>903</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;B1&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;N&nbsp;>=&nbsp;Maximum(B1^BF+1,&nbsp;B1^BL-1)*(B1^BF*B1^BL/2+1)&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line904"></a><div class='linenum'>904</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;B1:=B1+1;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line905"></a><div class='linenum'>905</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line906"></a><div class='linenum'>906</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;B1&nbsp;&lt;&nbsp;MaxB&nbsp;and&nbsp;N&nbsp;&lt;&nbsp;Maximum(B1^BF+1,B1^BL-1)*(B1^BF*B1^BL/2&nbsp;+&nbsp;1)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line907"></a><div class='linenum'>907</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;ForAll(Combinations(Fs,2),x->GcdInt(x[1],x[2])=1)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line908"></a><div class='linenum'>908</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;ForAll(Combinations(Ls,2),x->GcdInt(x[1],x[2])=1)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line909"></a><div class='linenum'>909</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;GotOne(&nbsp;[true,&nbsp;"BLS1975-Th21",&nbsp;[],&nbsp;B1,&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line910"></a><div class='linenum'>910</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set(Concatenation(&nbsp;R1s,R2s))]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line911"></a><div class='linenum'>911</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line912"></a><div class='linenum'>912</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line913"></a><div class='linenum'>913</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line914"></a><div class='linenum'>914</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;rets;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line915"></a><div class='linenum'>915</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line916"></a><div class='linenum'>916</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line917"></a><div class='linenum'>917</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line918"></a><div class='linenum'>918</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line919"></a><div class='linenum'>919</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;PrimalityProof_Verify(N,proof)&nbsp;-&nbsp;Verbosely&nbsp;verify&nbsp;a&nbsp;proposed&nbsp;primality
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line920"></a><div class='linenum'>920</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;proof.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line921"></a><div class='linenum'>921</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line922"></a><div class='linenum'>922</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line923"></a><div class='linenum'>923</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(PrimalityProof_Verify,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line924"></a><div class='linenum'>924</div></td><td></td><td></td><td></td><td><span><tt>function(N,proof)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line925"></a><div class='linenum'>925</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;theorems,theorem,x;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line926"></a><div class='linenum'>926</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;theorems:=PrimalityProof_VerifyStructure(N,proof);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line927"></a><div class='linenum'>927</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;theorems&nbsp;=&nbsp;[]&nbsp;then&nbsp;return&nbsp;fail;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line928"></a><div class='linenum'>928</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;not&nbsp;ForAll(proof,&nbsp;wit&nbsp;->&nbsp;PrimalityProof_VerifyWitness(N,wit))
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line929"></a><div class='linenum'>929</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;then&nbsp;return&nbsp;false;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line930"></a><div class='linenum'>930</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line931"></a><div class='linenum'>931</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;for&nbsp;theorem&nbsp;in&nbsp;theorems&nbsp;do
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line932"></a><div class='linenum'>932</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;Print("\nNumber&nbsp;proven&nbsp;prime&nbsp;by&nbsp;",theorem[2],"\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line933"></a><div class='linenum'>933</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;theorem[3]&nbsp;&lt;>&nbsp;[]&nbsp;)&nbsp;then&nbsp;Print("assuming&nbsp;each&nbsp;of&nbsp;",theorem[3],
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line934"></a><div class='linenum'>934</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"is&nbsp;prime\n");&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line935"></a><div class='linenum'>935</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;theorem[5]&nbsp;&lt;>&nbsp;[]&nbsp;then&nbsp;Print("assuming&nbsp;each&nbsp;of&nbsp;",&nbsp;theorem[5],
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line936"></a><div class='linenum'>936</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;have&nbsp;no&nbsp;nontrivial&nbsp;divisors&nbsp;less&nbsp;than&nbsp;",&nbsp;theorem[4]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line937"></a><div class='linenum'>937</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;:=&nbsp;Product(Filtered(Primes,p->p&lt;theorem[4]));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line938"></a><div class='linenum'>938</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;theorem[4]&nbsp;&lt;&nbsp;Maximum(Primes)&nbsp;and&nbsp;ForAll(theorem[5],&nbsp;p->
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line939"></a><div class='linenum'>939</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;in&nbsp;Primes&nbsp;or&nbsp;GcdInt(p,x)=1)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line940"></a><div class='linenum'>940</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;Print("(which&nbsp;is&nbsp;true)\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line941"></a><div class='linenum'>941</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Print("\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line942"></a><div class='linenum'>942</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line943"></a><div class='linenum'>943</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line944"></a><div class='linenum'>944</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;od;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line945"></a><div class='linenum'>945</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;return&nbsp;true;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line946"></a><div class='linenum'>946</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line947"></a><div class='linenum'>947</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line948"></a><div class='linenum'>948</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line949"></a><div class='linenum'>949</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line950"></a><div class='linenum'>950</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line951"></a><div class='linenum'>951</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;Section&nbsp;5:&nbsp;Pretty&nbsp;interface
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line952"></a><div class='linenum'>952</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line953"></a><div class='linenum'>953</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(1)&nbsp;Bind&nbsp;ProbablePrimes2
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line954"></a><div class='linenum'>954</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(2)&nbsp;IsPrimeIntReplacement&nbsp;-&nbsp;handle&nbsp;caching&nbsp;and&nbsp;warning
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line955"></a><div class='linenum'>955</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(3)&nbsp;IsProbablyPrimeIntReplacement&nbsp;-&nbsp;handle&nbsp;caching
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line956"></a><div class='linenum'>956</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;(4)&nbsp;Optional&nbsp;code&nbsp;to&nbsp;replace&nbsp;the&nbsp;main&nbsp;gap&nbsp;functions
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line957"></a><div class='linenum'>957</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line958"></a><div class='linenum'>958</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line959"></a><div class='linenum'>959</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line960"></a><div class='linenum'>960</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line961"></a><div class='linenum'>961</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line962"></a><div class='linenum'>962</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;IsPrimeInt(N)&nbsp;-&nbsp;Perform&nbsp;as&nbsp;IsPrimeInt,&nbsp;but&nbsp;use&nbsp;PrimalityProof
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line963"></a><div class='linenum'>963</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;to&nbsp;avoid&nbsp;using&nbsp;any&nbsp;unproven&nbsp;primes.&nbsp;Store&nbsp;proofs&nbsp;in&nbsp;PrimesProofs.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line964"></a><div class='linenum'>964</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line965"></a><div class='linenum'>965</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line966"></a><div class='linenum'>966</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(IsPrimeInt,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line967"></a><div class='linenum'>967</div></td><td></td><td></td><td></td><td><span><tt>function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line968"></a><div class='linenum'>968</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;ret;
</tt></span></td><td><span></span></td></tr>
<tr class='exec'><td><a name="line969"></a><div class='linenum'>969</div></td><td>243</td><td>472</td><td>585</td><td><span><tt>&nbsp;&nbsp;N&nbsp;:=&nbsp;AbsInt(N);
</tt></span></td><td><span><a href="_opt_gap_gap4r8p5_lib_integer.gi.html#line1287">AbsInt</a> </span></td></tr>
<tr class='exec'><td><a name="line970"></a><div class='linenum'>970</div></td><td>243</td><td>808</td><td>808</td><td><span><tt>&nbsp;&nbsp;if(N&nbsp;in&nbsp;Primes2)&nbsp;then&nbsp;return&nbsp;true;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line971"></a><div class='linenum'>971</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;ret:=&nbsp;IsBPSWPseudoPrime(N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line972"></a><div class='linenum'>972</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;ret&nbsp;=&nbsp;false&nbsp;&nbsp;then&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line973"></a><div class='linenum'>973</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;ret&nbsp;=&nbsp;true&nbsp;and&nbsp;N&nbsp;&lt;&nbsp;10^13&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line974"></a><div class='linenum'>974</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;AddSet(Primes2,N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line975"></a><div class='linenum'>975</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line976"></a><div class='linenum'>976</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;ret&nbsp;=&nbsp;true&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line977"></a><div class='linenum'>977</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;:=&nbsp;PrimalityProof(N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line978"></a><div class='linenum'>978</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;PrimalityProof_VerifyStructure(N,ret)&nbsp;&lt;>&nbsp;[]&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line979"></a><div class='linenum'>979</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddSet(Primes2,N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line980"></a><div class='linenum'>980</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddSet(PrimesProofs,[N,ret]);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line981"></a><div class='linenum'>981</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;else
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line982"></a><div class='linenum'>982</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Info(InfoPrimeInt,&nbsp;1,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line983"></a><div class='linenum'>983</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"IsPrimeInt:&nbsp;probably&nbsp;prime,&nbsp;but&nbsp;not&nbsp;proven:&nbsp;",&nbsp;N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line984"></a><div class='linenum'>984</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddSet(&nbsp;ProbablePrimes2,&nbsp;N&nbsp;);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line985"></a><div class='linenum'>985</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line986"></a><div class='linenum'>986</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line987"></a><div class='linenum'>987</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line988"></a><div class='linenum'>988</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;Error("Bad&nbsp;return&nbsp;from&nbsp;IsBPSWPseudoPrime");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line989"></a><div class='linenum'>989</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line990"></a><div class='linenum'>990</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line991"></a><div class='linenum'>991</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line992"></a><div class='linenum'>992</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line993"></a><div class='linenum'>993</div></td><td></td><td></td><td></td><td><span><tt>#F&nbsp;&nbsp;IsProbablyPrimeInt(N)&nbsp;-&nbsp;Perform&nbsp;as&nbsp;isProbablyPrimeInt
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line994"></a><div class='linenum'>994</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;calling&nbsp;the&nbsp;optimized&nbsp;BPSW&nbsp;test&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;GAP&nbsp;default.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line995"></a><div class='linenum'>995</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line996"></a><div class='linenum'>996</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;The&nbsp;option&nbsp;"RabinMillerTrials"&nbsp;may&nbsp;be&nbsp;passed&nbsp;to&nbsp;force&nbsp;additional
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line997"></a><div class='linenum'>997</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;probablistic&nbsp;tests&nbsp;to&nbsp;be&nbsp;run&nbsp;for&nbsp;larger&nbsp;N.&nbsp;The&nbsp;cost&nbsp;can&nbsp;be&nbsp;quite&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line998"></a><div class='linenum'>998</div></td><td></td><td></td><td></td><td><span><tt>##&nbsp;&nbsp;significant&nbsp;for&nbsp;large&nbsp;N.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line999"></a><div class='linenum'>999</div></td><td></td><td></td><td></td><td><span><tt>##
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1000"></a><div class='linenum'>1000</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1001"></a><div class='linenum'>1001</div></td><td></td><td></td><td></td><td><span><tt>InstallGlobalFunction(IsProbablyPrimeInt,
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1002"></a><div class='linenum'>1002</div></td><td></td><td></td><td></td><td><span><tt>function(N)
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1003"></a><div class='linenum'>1003</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;local&nbsp;ret,&nbsp;RabinMillerTrials;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1004"></a><div class='linenum'>1004</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if(N&nbsp;in&nbsp;Primes2&nbsp;or&nbsp;N&nbsp;in&nbsp;ProbablePrimes2)&nbsp;then&nbsp;return&nbsp;true;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1005"></a><div class='linenum'>1005</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;ret&nbsp;:=&nbsp;IsBPSWPseudoPrime(N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1006"></a><div class='linenum'>1006</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1007"></a><div class='linenum'>1007</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;if&nbsp;ret&nbsp;=&nbsp;false&nbsp;then&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1008"></a><div class='linenum'>1008</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Otherwise&nbsp;is&nbsp;BPSW&nbsp;number,&nbsp;and&nbsp;all&nbsp;such&nbsp;&lt;&nbsp;10^13&nbsp;are&nbsp;prime
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1009"></a><div class='linenum'>1009</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;elif&nbsp;ret&nbsp;=&nbsp;true&nbsp;and&nbsp;N&nbsp;&lt;&nbsp;10&nbsp;^&nbsp;13&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1010"></a><div class='linenum'>1010</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;AddSet(Primes2,N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1011"></a><div class='linenum'>1011</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1012"></a><div class='linenum'>1012</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;#&nbsp;Otherwise&nbsp;give&nbsp;a&nbsp;dose&nbsp;of&nbsp;Rabin-Miller
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1013"></a><div class='linenum'>1013</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;else
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1014"></a><div class='linenum'>1014</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;RabinMillerTrials&nbsp;:=&nbsp;ValueOption("RabinMillerTrials");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1015"></a><div class='linenum'>1015</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;RabinMillerTrials&nbsp;=&nbsp;fail&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1016"></a><div class='linenum'>1016</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RabinMillerTrials:=0;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1017"></a><div class='linenum'>1017</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RabinMillerTrials:=&nbsp;RootInt(Maximum(0,LogInt(N,10)-13));
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1018"></a><div class='linenum'>1018</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;IsFunction(RabinMillerTrials)&nbsp;then&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1019"></a><div class='linenum'>1019</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RabinMillerTrials:=RabinMillerTrials(N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1020"></a><div class='linenum'>1020</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1021"></a><div class='linenum'>1021</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;ForAll([1..RabinMillerTrials],i->
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1022"></a><div class='linenum'>1022</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IsStrongPseudoPrimeBaseA(N,Random(3,N-1)))&nbsp;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1023"></a><div class='linenum'>1023</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;then
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1024"></a><div class='linenum'>1024</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddSet(ProbablePrimes2,N);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1025"></a><div class='linenum'>1025</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1026"></a><div class='linenum'>1026</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Otherwise&nbsp;an&nbsp;error&nbsp;or&nbsp;composite&nbsp;BPSW&nbsp;number&nbsp;has&nbsp;been&nbsp;found.
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1027"></a><div class='linenum'>1027</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;else
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1028"></a><div class='linenum'>1028</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Print("\n\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1029"></a><div class='linenum'>1029</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Print("#&nbsp;!!!&nbsp;Please&nbsp;email&nbsp;support@gap-system.org&nbsp;the&nbsp;following:\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1030"></a><div class='linenum'>1030</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Print("#&nbsp;!!!&nbsp;BPSW&nbsp;failed&nbsp;on&nbsp;",HexStringInt(N),"\n\n\n");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1031"></a><div class='linenum'>1031</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Error("#&nbsp;!!!&nbsp;You&nbsp;have&nbsp;probably&nbsp;found&nbsp;a&nbsp;bug.&nbsp;Theoretically&nbsp;&lt;n>&nbsp;is&nbsp;composite.");
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1032"></a><div class='linenum'>1032</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1033"></a><div class='linenum'>1033</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1034"></a><div class='linenum'>1034</div></td><td></td><td></td><td></td><td><span><tt>&nbsp;&nbsp;fi;
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1035"></a><div class='linenum'>1035</div></td><td></td><td></td><td></td><td><span><tt>end);
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1036"></a><div class='linenum'>1036</div></td><td></td><td></td><td></td><td><span><tt>
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1037"></a><div class='linenum'>1037</div></td><td></td><td></td><td></td><td><span><tt>##############################################################################
</tt></span></td><td><span></span></td></tr>
<tr class='ignore'><td><a name="line1038"></a><div class='linenum'>1038</div></td><td></td><td></td><td></td><td><span><tt>#E
</tt></span></td><td><span></span></td></tr>
</tbody>
</table></body></html>
